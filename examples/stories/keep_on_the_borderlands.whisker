{
  "format": "whisker",
  "formatVersion": "1.0",
  "metadata": {
    "title": "The Keep on the Borderlands",
    "author": "Adapted from Gary Gygax's classic module",
    "created": "2025-10-09T23:37:00",
    "modified": "2025-10-09T23:37:00",
    "ifid": "B2KEEP-4444-4001-8001-BORDERLANDS01",
    "description": "A solo adventure in the legendary Caves of Chaos - adapted from the classic D&D module B2",
    "tags": ["fantasy", "adventure", "dungeon", "classic", "solo"]
  },
  "settings": {
    "startPassage": "character_creation_intro",
    "theme": "default",
    "scriptingLanguage": "lua",
    "undoLimit": 50,
    "autoSave": true
  },
  "variables": {
    "player_name": "Adventurer",
    "character_created": false,
    "class": "Fighter",
    "level": 1,
    "experience": 0,
    "health": 20,
    "max_health": 20,
    "stamina": 10,
    "max_stamina": 10,
    "strength": 10,
    "dexterity": 10,
    "constitution": 10,
    "intelligence": 10,
    "wisdom": 10,
    "charisma": 10,
    "armor_class": 10,
    "attack_bonus": 0,
    "damage_bonus": 0,
    "skill_points": 0,
    "skill_persuasion": 0,
    "skill_perception": 0,
    "skill_lockpicking": 0,
    "skill_stealth": 0,
    "skill_arcana": 0,
    "skill_medicine": 0,
    "gold": 50,
    "weapon_name": "Rusty Sword",
    "weapon_damage": "1d6",
    "weapon_bonus": 0,
    "armor_name": "Leather Armor",
    "armor_ac": 11,
    "has_sword": true,
    "has_shield": false,
    "has_healing_potion": false,
    "has_rope": false,
    "has_torch": true,
    "has_magic_sword": false,
    "has_lantern": false,
    "has_map": false,
    "companion_name": "none",
    "companion_health": 0,
    "companion_max_health": 0,
    "companion_ability": "",
    "companion_loyalty": 0,
    "alignment_good_evil": 0,
    "alignment_lawful_chaotic": 0,
    "quest_clear_caves": 0,
    "quest_merchant_treasure": false,
    "quest_hermit_herbs": false,
    "quest_castellan_orcs": false,
    "monsters_killed": 0,
    "explored_kobold_lair": false,
    "explored_orc_lair": false,
    "explored_goblin_lair": false,
    "explored_bugbear_lair": false,
    "explored_hermit": false,
    "kobolds_defeated": false,
    "found_secret_treasure": false,
    "warned_by_merchant": false,
    "received_blessing": false,
    "heard_rumors": false,
    "met_hermit": false,
    "helped_hermit": false,
    "has_hermit_map": false,
    "found_elven_ruins": false,
    "castellan_quest_active": false,
    "castellan_quest_complete": false,
    "reputation": 0,
    "random_encounter_count": 0,
    "solved_riddle": false,
    "solved_statue_puzzle": false,
    "found_secret_chamber": false,
    "made_peace_all_tribes": false,
    "touched_cursed_idol": false,
    "became_hermit": false
  },
  "passages": [
    {
      "pid": "p001",
      "name": "start",
      "text": "**The Keep on the Borderlands**\n*A Solo Adventure*\n\nYou are a young adventurer who has traveled many days to reach the Keep on the Borderlands, a lonely fortress that stands between civilization and the wild, untamed lands beyond.\n\nWord has spread of the Caves of Chaos - a winding ravine filled with caves inhabited by evil humanoids and worse. The Castellan offers rewards for those brave enough to clear out these threats.\n\nYou stand at the gates of the Keep with {{gold}} gold pieces, a trusty sword, and a burning desire for adventure.\n\n**Health:** {{health}}/{{max_health}}\n\n[[Enter the Keep->keep_entrance]]\n[[Head directly to the Caves of Chaos->to_caves_direct]]",
      "tags": ["start"],
      "position": {"x": 100, "y": 100},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p002",
      "name": "keep_entrance",
      "text": "You pass through the massive gates into the outer bailey of the Keep. The courtyard buzzes with activity - guards patrol the walls, merchants hawk their wares, and common folk go about their business.\n\nSeveral buildings stand around you:\n- The Travelers' Inn, where you can rest\n- The Provisioner's shop, selling adventuring supplies\n- The Tavern, where rumors and information flow freely\n- The Chapel, offering blessings to those who fight evil\n- The Inner Keep, where the Castellan resides\n- The Training Yard, where guards practice\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n[[Visit the Provisioner->provisioner]]\n[[Go to the Tavern->tavern]]\n{{#if health < max_health}}[[Rest at the Inn->inn]]{{/if}}\n[[Visit the Chapel->chapel]]\n[[Seek audience with the Castellan->castellan]]\n[[Visit the Training Yard->training_yard]]\n[[Journey to the Caves of Chaos->to_caves]]",
      "tags": ["keep", "hub"],
      "position": {"x": 100, "y": 250},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p003",
      "name": "provisioner",
      "text": "The Provisioner's shop is stocked with various adventuring supplies. The shopkeeper eyes you carefully.\n\n\"What can I get for you, adventurer?\"\n\nAvailable items:\n- Shield (20 gold) {{#if has_shield}}- PURCHASED{{/if}}\n- Healing Potion (30 gold) {{#if has_healing_potion}}- PURCHASED{{/if}}\n- Rope (15 gold) {{#if has_rope}}- PURCHASED{{/if}}\n\n**Your gold:** {{gold}}\n\n{{#if gold >= 20 and not has_shield}}[[Buy a shield (20 gold)->buy_shield]]{{/if}}\n{{#if gold >= 30 and not has_healing_potion}}[[Buy a healing potion (30 gold)->buy_potion]]{{/if}}\n{{#if gold >= 15 and not has_rope}}[[Buy rope (15 gold)->buy_rope]]{{/if}}\n[[Leave the shop->keep_entrance]]",
      "tags": ["keep", "shop"],
      "position": {"x": -100, "y": 250},
      "size": {"width": 200, "height": 140}
    },
    {
      "pid": "p004",
      "name": "buy_shield",
      "text": "You purchase a sturdy wooden shield. It will help protect you in battle!\n\n**Shield acquired!**\n**Gold remaining:** {{gold - 20}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 20); game_state:set_variable(\"has_shield\", true) }}\n\n[[Continue shopping->provisioner]]\n[[Leave->keep_entrance]]",
      "tags": ["keep", "shop"],
      "position": {"x": -250, "y": 350},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p005",
      "name": "buy_potion",
      "text": "You purchase a healing potion in a small glass vial. It glows with a soft red light.\n\n\"This will restore 10 health when you drink it,\" the shopkeeper says.\n\n**Healing Potion acquired!**\n**Gold remaining:** {{gold - 30}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 30); game_state:set_variable(\"has_healing_potion\", true) }}\n\n[[Continue shopping->provisioner]]\n[[Leave->keep_entrance]]",
      "tags": ["keep", "shop"],
      "position": {"x": -150, "y": 400},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p006",
      "name": "buy_rope",
      "text": "You purchase 50 feet of strong rope. It might come in handy for climbing!\n\n**Rope acquired!**\n**Gold remaining:** {{gold - 15}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 15); game_state:set_variable(\"has_rope\", true) }}\n\n[[Continue shopping->provisioner]]\n[[Leave->keep_entrance]]",
      "tags": ["keep", "shop"],
      "position": {"x": -50, "y": 350},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p007",
      "name": "tavern",
      "text": "The tavern is warm and crowded. The smell of ale and roasted meat fills the air. You find a seat at the bar.\n\nThe barkeeper leans in. \"First time here? You look like you're heading to those cursed caves. Let me give you some advice...\"\n\n\"The kobolds have the lowest caves - they're weak but numerous. The orcs and goblins are always fighting each other. And whatever you do, stay away from the shrine at the far end of the ravine. Dark magic there.\"\n\n{{#if warned_by_merchant}}A traveling merchant in the corner waves at you.{{/if}}\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n{{lua: if not game_state:get_variable(\"heard_rumors\") then game_state:set_variable(\"heard_rumors\", true) end }}\n\n{{#if not warned_by_merchant}}[[Talk to the merchant->merchant]]{{/if}}\n{{#if gold >= 5}}[[Buy a drink and listen for more rumors (5 gold)->tavern_rumors]]{{/if}}\n[[Leave the tavern->keep_entrance]]",
      "tags": ["keep", "tavern"],
      "position": {"x": 300, "y": 250},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p008",
      "name": "merchant",
      "text": "The merchant gestures for you to sit. He's a portly man with nervous eyes.\n\n\"Listen friend,\" he whispers, \"I was ambushed near the caves last week. Lost most of my goods. But I managed to hide a sack of coins in a hollow tree just outside the ravine - southeast of the main entrance. If you find it, it's yours. Consider it payment for avenging me.\"\n\nHe sketches a rough map on a napkin.\n\n**You've learned the location of hidden treasure!**\n\n{{lua: game_state:set_variable(\"warned_by_merchant\", true) }}\n\n[[Thank him and return to the bar->tavern]]",
      "tags": ["keep", "tavern", "quest"],
      "position": {"x": 450, "y": 350},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p009",
      "name": "tavern_rumors",
      "text": "You buy a round of ale and listen to the chatter. You pick up several useful pieces of information:\n\n- \"Someone said there's a mad hermit in the woods. Dangerous fellow.\"\n- \"The bugbears are the strongest in the caves, but they keep to themselves.\"\n- \"If you can turn the tribes against each other, they'll do your work for you.\"\n\n**Gold:** {{gold - 5}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 5) }}\n\n[[Leave the tavern->keep_entrance]]",
      "tags": ["keep", "tavern"],
      "position": {"x": 350, "y": 400},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p010",
      "name": "inn",
      "text": "You rent a room at the Travelers' Inn for the night. The bed is simple but clean, and you sleep soundly.\n\nIn the morning, you feel refreshed and ready for adventure!\n\n**Health fully restored!**\n**Gold:** {{gold - 10}}\n\n{{lua: game_state:set_variable(\"health\", game_state:get_variable(\"max_health\")); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 10) }}\n\n[[Leave the inn->keep_entrance]]",
      "tags": ["keep", "inn"],
      "position": {"x": 100, "y": 400},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p011",
      "name": "chapel",
      "text": "You enter the chapel. A priest in simple robes greets you with a warm smile.\n\n\"Welcome, child. Are you heading into danger? Let me offer you a blessing.\"\n\nHe places his hand on your forehead and speaks a prayer. You feel a warm sensation flow through you.\n\n{{#if not received_blessing}}\n**Maximum health increased by 5!**\n**Current health restored!**\n{{lua: game_state:set_variable(\"max_health\", game_state:get_variable(\"max_health\") + 5); game_state:set_variable(\"health\", game_state:get_variable(\"max_health\")); game_state:set_variable(\"received_blessing\", true) }}\n{{else}}\n\"You have already received my blessing. Go with courage!\"\n{{/if}}\n\n[[Thank the priest and leave->keep_entrance]]",
      "tags": ["keep", "chapel"],
      "position": {"x": -100, "y": 100},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p012",
      "name": "to_caves_direct",
      "text": "You set off immediately toward the Caves of Chaos, confident in your abilities.\n\nThe journey takes most of the day. As the sun begins to set, you emerge from the dark forest into a rocky ravine. Cave mouths dot the cliff walls on both sides, like the eyes of some great beast.\n\nThe air is thick with menace. Bones litter the ground - some human, some animal.\n\nYou've found the Caves of Chaos.\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n[[Explore the lower caves->cave_entrance]]\n{{#if not warned_by_merchant}}[[Look for hidden treasure->no_map]]{{/if}}\n[[Return to the Keep->keep_entrance]]",
      "tags": ["travel"],
      "position": {"x": 300, "y": 100},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p013",
      "name": "to_caves",
      "text": "You leave the safety of the Keep and journey through the wilderness. The road gradually becomes a narrow trail, then disappears entirely as you enter dark, twisted woods.\n\nAs you travel, you notice various paths and landmarks.\n\n{{#if warned_by_merchant}}You remember the merchant's directions to the hidden treasure.{{/if}}\n{{#if met_hermit}}You recall the hermit mentioning elven ruins to the north.{{/if}}\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n{{lua: if math.random(1, 3) == 1 then game_state:set_variable(\"trigger_random_encounter\", true) else game_state:set_variable(\"trigger_random_encounter\", false) end }}\n\n{{#if trigger_random_encounter}}[[Something unexpected happens!->random_encounter]]{{/if}}\n[[Notice a side trail->wilderness_exploration]]\n{{#if met_hermit and not found_elven_ruins}}[[Search for the elven ruins to the north->elven_ruins]]{{/if}}\n{{#if warned_by_merchant and not found_secret_treasure}}[[Look for the merchant's hidden treasure->find_treasure]]{{/if}}\n[[Continue to the Caves of Chaos->cave_entrance]]\n[[Return to the Keep->keep_entrance]]",
      "tags": ["travel"],
      "position": {"x": 100, "y": 550},
      "size": {"width": 200, "height": 140}
    },
    {
      "pid": "p014",
      "name": "no_map",
      "text": "You search the area for hidden treasure, but without any directions, you find nothing but rocks and bones.\n\nIt would help to have more information.\n\n[[Enter the caves->cave_entrance]]\n[[Return to the Keep->keep_entrance]]",
      "tags": ["caves"],
      "position": {"x": 500, "y": 100},
      "size": {"width": 180, "height": 80}
    },
    {
      "pid": "p015",
      "name": "find_treasure",
      "text": "Following the merchant's directions, you search southeast of the ravine entrance. After some searching, you find a hollow tree!\n\nInside is a leather sack containing gold coins!\n\n**You found 100 gold pieces!**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 100); game_state:set_variable(\"found_secret_treasure\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 1) }}\n\n[[Continue to the caves->cave_entrance]]\n[[Return to the Keep with your find->keep_entrance]]",
      "tags": ["caves", "treasure"],
      "position": {"x": 300, "y": 550},
      "size": {"width": 180, "height": 110}
    },
    {
      "pid": "p016",
      "name": "cave_entrance",
      "text": "You stand at the entrance to the ravine. Several cave mouths are visible:\n\nTo your left, a low cave entrance has strange markings carved around it.\n{{#if explored_kobold_lair}}(You've already explored the kobold lair){{/if}}\n\nHigher up, you can see two larger cave entrances - likely the orc and goblin lairs the barkeeper mentioned.\n{{#if explored_orc_lair}}(You've already explored the orc lair){{/if}}\n{{#if explored_goblin_lair}}(You've already explored the goblin lair){{/if}}\n\n{{#if has_hermit_map}}The hermit's map shows a secret entrance to the bugbear lair!{{else}}You can see another large cave, but it looks heavily guarded.{{/if}}\n{{#if explored_bugbear_lair}}(You've dealt with the bugbears){{/if}}\n\nAt the far end of the ravine, you can make out a dark cave with an ominous aura.\n\n{{#if has_map}}Your map shows there's a secret chamber hidden somewhere in these caves!{{/if}}\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n{{#if has_healing_potion}}**Items:** Healing Potion{{/if}}\n\n{{#if not explored_kobold_lair}}[[Explore the low cave (Kobold Lair)->kobold_cave]]{{/if}}\n{{#if not explored_orc_lair}}[[Climb to the orc lair->orc_cave]]{{/if}}\n{{#if not explored_goblin_lair}}[[Investigate the goblin lair->goblin_cave]]{{/if}}\n{{#if not explored_bugbear_lair}}[[Approach the bugbear lair->bugbear_lair]]{{/if}}\n{{#if has_map or found_secret_chamber}}[[Search for the secret chamber->secret_chamber]]{{/if}}\n[[Approach the dark shrine (dangerous!)->evil_shrine]]\n[[Explore the wilderness->wilderness_exploration]]\n{{#if gold >= 500 or helped_hermit or reputation >= 8}}[[Consider your path forward...->check_endings]]{{/if}}\n[[Return to the Keep to rest and resupply->keep_entrance]]",
      "tags": ["caves", "hub"],
      "position": {"x": 100, "y": 700},
      "size": {"width": 220, "height": 180}
    },
    {
      "pid": "p017",
      "name": "kobold_cave",
      "text": "You enter the low cave, having to crouch to fit through the entrance. The smell of unwashed bodies and rotting meat assaults your nose.\n\nAs your eyes adjust to the darkness, you see movement ahead - small, dog-like humanoids with scaly skin. Kobolds!\n\nThree kobolds notice you and let out high-pitched yips of alarm, drawing crude weapons!\n\n**Health:** {{health}}/{{max_health}}\n{{#if has_shield}}Your shield is ready!{{/if}}\n\n[[Fight the kobolds!->fight_kobolds]]\n[[Try to scare them with a fierce battle cry->scare_kobolds]]\n[[Retreat from the cave->cave_entrance]]",
      "tags": ["caves", "kobold", "combat"],
      "position": {"x": -150, "y": 700},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p018",
      "name": "fight_kobolds",
      "text": "You charge into battle! Your sword flashes in the dim light as you strike at the kobolds.\n\nThe creatures fight back ferociously, but they're weak and poorly armed.\n{{#if has_shield}}Your shield deflects several blows!{{else}}Without a shield, you take several cuts and scrapes.{{/if}}\n\nAfter a brief but intense fight, the three kobolds lie defeated. The others flee deeper into the caves, yipping in terror.\n\n**Damage taken:** {{#if has_shield}}5{{else}}10{{/if}} health\n**Kobolds defeated!**\n\nSearching the room, you find {{#if kobolds_defeated}}nothing more of value{{else}}a small pouch with 20 gold pieces and a rusty dagger{{/if}}!\n\n{{lua: local damage = game_state:get_variable(\"has_shield\") and 5 or 10; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)); if not game_state:get_variable(\"kobolds_defeated\") then game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 20); game_state:set_variable(\"kobolds_defeated\", true); game_state:set_variable(\"explored_kobold_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 2) end }}\n\n{{#if has_healing_potion and health < max_health}}[[Use your healing potion->use_potion_kobolds]]{{/if}}\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}[[Explore deeper into the kobold lair->kobold_deeper]]\n[[Leave and return to the ravine->cave_entrance]]{{/if}}",
      "tags": ["caves", "kobold", "combat"],
      "position": {"x": -300, "y": 800},
      "size": {"width": 200, "height": 180}
    },
    {
      "pid": "p019",
      "name": "scare_kobolds",
      "text": "You raise your sword high and let out a terrifying war cry!\n\nThe kobolds freeze, their eyes wide with fear. These creatures are natural cowards, and your display of confidence unnerves them.\n\nAfter a moment of hesitation, all three kobolds drop their weapons and flee deeper into the caves, yipping in panic!\n\n**No damage taken!**\n**The kobolds are scattered!**\n\nYou've earned a reputation for fierceness.\n\n{{lua: game_state:set_variable(\"kobolds_defeated\", true); game_state:set_variable(\"explored_kobold_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 1) }}\n\n[[Explore deeper into the kobold lair->kobold_deeper]]\n[[Leave while they're scattered->cave_entrance]]",
      "tags": ["caves", "kobold"],
      "position": {"x": -150, "y": 850},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p020",
      "name": "kobold_deeper",
      "text": "You venture deeper into the kobold warren. The passages are cramped and twist in confusing patterns.\n\nIn a larger chamber, you find the kobolds' storage area. Most of it is worthless junk and rotting food, but you do find some items of value.\n\n**You found:**\n- 30 gold pieces\n- A silver dagger (worth 20 gold)\n- Torches and supplies\n\nThe kobolds have fled, and you've cleared this lair!\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 50); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 1) }}\n\n[[Return to the ravine entrance->cave_entrance]]",
      "tags": ["caves", "kobold", "treasure"],
      "position": {"x": -250, "y": 950},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p021",
      "name": "use_potion_kobolds",
      "text": "You drink the healing potion. A warm sensation flows through your body as your wounds begin to close.\n\n**Health restored by 10!**\n**Health:** {{health + 10}}/{{max_health}}\n\n{{lua: local health = game_state:get_variable(\"health\"); local max_health = game_state:get_variable(\"max_health\"); game_state:set_variable(\"health\", math.min(max_health, health + 10)); game_state:set_variable(\"has_healing_potion\", false) }}\n\n[[Continue exploring->kobold_deeper]]\n[[Return to the ravine->cave_entrance]]",
      "tags": ["caves", "healing"],
      "position": {"x": -450, "y": 850},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p022",
      "name": "orc_cave",
      "text": "You climb the rocky slope to reach a larger cave entrance. As you approach, you hear guttural voices speaking in a harsh tongue.\n\nPeering around the corner, you see two orc guards standing watch. They're larger and tougher than the kobolds, with tusked faces and battle-scarred armor.\n\nBeyond them, you can hear more orcs - perhaps half a dozen in the main chamber.\n\nThis will be a serious fight.\n\n**Health:** {{health}}/{{max_health}}\n\n[[Attack the guards directly->fight_orc_guards]]\n[[Try to sneak past the guards->sneak_orcs]]\n[[This seems too dangerous - retreat->cave_entrance]]",
      "tags": ["caves", "orc"],
      "position": {"x": 350, "y": 700},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p023",
      "name": "fight_orc_guards",
      "text": "You charge at the orc guards with your sword raised!\n\nThe orcs react quickly, drawing their weapons. The battle is fierce and brutal. These creatures are far stronger than kobolds!\n\n{{#if has_shield}}Your shield saves you from several crushing blows!{{else}}Without a shield, you take heavy damage from their axes!{{/if}}\n\nAfter a desperate fight, you manage to defeat both guards, but at a cost. The sounds of battle have alerted the other orcs inside!\n\n**Damage taken:** {{#if has_shield}}12{{else}}18{{/if}} health\n**Orc guards defeated!**\n\nYou hear heavy footsteps approaching - more orcs are coming!\n\n{{lua: local damage = game_state:get_variable(\"has_shield\") and 12 or 18; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)) }}\n\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}{{#if has_healing_potion and health < 15}}[[Use your healing potion quickly!->use_potion_orcs]]{{/if}}\n{{#if health >= 15}}[[Stand and fight the reinforcements!->fight_orc_horde]]{{/if}}\n{{#if health < 15}}[[Retreat while you still can!->orc_retreat]]{{/if}}{{/if}}",
      "tags": ["caves", "orc", "combat"],
      "position": {"x": 500, "y": 800},
      "size": {"width": 200, "height": 180}
    },
    {
      "pid": "p024",
      "name": "use_potion_orcs",
      "text": "You quickly drink your healing potion as the orc reinforcements approach!\n\nThe warm magic flows through you, healing your wounds just in time.\n\n**Health restored by 10!**\n**Health:** {{health + 10}}/{{max_health}}\n\nNow you must face the orc war party!\n\n{{lua: local health = game_state:get_variable(\"health\"); local max_health = game_state:get_variable(\"max_health\"); game_state:set_variable(\"health\", math.min(max_health, health + 10)); game_state:set_variable(\"has_healing_potion\", false) }}\n\n[[Fight the orc war party!->fight_orc_horde]]",
      "tags": ["caves", "orc", "healing"],
      "position": {"x": 650, "y": 850},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p025",
      "name": "fight_orc_horde",
      "text": "Six more orcs pour out of the cave! This is madness - you're outnumbered!\n\nBut something amazing happens. Your fierce battle cry and the sight of their fallen comrades causes the orcs to hesitate. You press the advantage, fighting with desperate strength!\n\n{{#if reputation >= 3}}Your reputation precedes you - some of the orcs actually look frightened!{{/if}}\n\nThe battle is brutal and exhausting. One by one, the orcs fall before your blade. When the last orc collapses, you stand victorious but barely able to stand.\n\n**This is your greatest victory!**\n**Damage taken:** {{#if has_shield}}10{{else}}15{{/if}} more health\n\nYou find significant treasure in the orc lair:\n- 150 gold pieces\n- A silver war horn\n- Various weapons and armor\n\n**The orc lair is cleared!**\n\n{{lua: local damage = game_state:get_variable(\"has_shield\") and 10 or 15; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 150); game_state:set_variable(\"explored_orc_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 5) }}\n\n{{#if health <= 0}}[[You've been defeated at the moment of victory...->death]]{{else}}[[Return to the Keep to rest and celebrate->keep_entrance]]\n{{#if health > 5}}[[Continue exploring despite your wounds->cave_entrance]]{{/if}}{{/if}}",
      "tags": ["caves", "orc", "combat", "victory"],
      "position": {"x": 500, "y": 950},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p026",
      "name": "sneak_orcs",
      "text": "You attempt to sneak past the guards while they're distracted...\n\nUnfortunately, you knock a loose stone with your foot! The guards whirl around and spot you immediately.\n\n\"INTRUDER!\" one of them roars.\n\nYou're forced into combat in a bad position!\n\n**Surprise attack!**\n**Damage taken: 15 health**\n\n{{lua: local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - 15)) }}\n\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}[[Fight back!->fight_orc_guards]]\n[[Flee!->orc_retreat]]{{/if}}",
      "tags": ["caves", "orc"],
      "position": {"x": 650, "y": 700},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p027",
      "name": "orc_retreat",
      "text": "You turn and run from the orc lair! The orcs chase you for a while, hurling insults and throwing rocks, but eventually give up the pursuit.\n\nYou've escaped alive, but the orcs remain a threat.\n\n**Health:** {{health}}/{{max_health}}\n\n[[Return to the Keep to heal->keep_entrance]]\n{{#if health > 10}}[[Try a different cave->cave_entrance]]{{/if}}",
      "tags": ["caves", "orc"],
      "position": {"x": 750, "y": 800},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p028",
      "name": "goblin_cave",
      "text": "You approach another cave entrance. This one shows signs of more organized habitation - there's a crude wooden door partially covering the entrance.\n\nAs you get closer, you hear goblin voices arguing inside. They seem to be fighting among themselves!\n\n{{#if explored_orc_lair}}Perhaps you could use the rivalry between the orcs and goblins to your advantage?{{/if}}\n\n**Health:** {{health}}/{{max_health}}\n\n[[Attack while they're distracted->attack_goblins]]\n{{#if explored_orc_lair}}[[Try to trick them by claiming the orcs sent you->trick_goblins]]{{/if}}\n[[Leave them alone for now->cave_entrance]]",
      "tags": ["caves", "goblin"],
      "position": {"x": 100, "y": 900},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p029",
      "name": "attack_goblins",
      "text": "You burst into the goblin lair! Four goblins are standing around a fire, arguing. They're caught completely by surprise!\n\nYou strike down two before they even realize what's happening. The other two grab weapons and fight back, but they're panicked and disorganized.\n\nAfter a quick battle, all four goblins lie defeated.\n\n**Damage taken:** {{#if has_shield}}6{{else}}10{{/if}} health\n\nSearching the lair, you find:\n- 80 gold pieces\n- A well-made dagger\n- Stolen supplies from the Keep\n\n**The goblin scouts are defeated!**\n\n{{lua: local damage = game_state:get_variable(\"has_shield\") and 6 or 10; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 80); game_state:set_variable(\"explored_goblin_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 3) }}\n\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}[[Return to the ravine->cave_entrance]]\n{{#if health > 10}}[[Explore deeper into the goblin territory->goblin_deeper]]{{/if}}{{/if}}",
      "tags": ["caves", "goblin", "combat"],
      "position": {"x": -50, "y": 1000},
      "size": {"width": 200, "height": 160}
    },
    {
      "pid": "p030",
      "name": "trick_goblins",
      "text": "You bang on the door and shout in your best orcish accent: \"Message from the orc chief! He demands tribute!\"\n\nThe goblins stop arguing. After a moment, one calls back: \"The orcs can go eat rocks! We're done paying them!\"\n\nYour trick backfires - they're not falling for it. But you've learned that the orcs and goblins are bitter enemies!\n\nNow the goblins know someone is outside...\n\n[[Attack while they're confused->attack_goblins]]\n[[Retreat->cave_entrance]]",
      "tags": ["caves", "goblin"],
      "position": {"x": 250, "y": 1000},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p031",
      "name": "goblin_deeper",
      "text": "You press deeper into the goblin warren and discover their main chamber. Several goblins cower in the corner - they've heard of your victories and are terrified!\n\nThey beg for mercy, offering you information: \"The evil shrine at the end of the ravine - it's where the real evil is! Dark priests and undead! We're just trying to survive!\"\n\nYou can spare them or finish them off.\n\n[[Spare them and leave->spare_goblins]]\n[[Finish them off->slay_goblins]]",
      "tags": ["caves", "goblin", "choice"],
      "position": {"x": -50, "y": 1150},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p032",
      "name": "spare_goblins",
      "text": "You spare the remaining goblins. They're so grateful they give you what treasure they have left and promise to leave the area.\n\n\"You're a true hero,\" one says. \"Not like those evil priests!\"\n\n**You gained:**\n- 50 gold pieces\n- The respect of even your enemies\n- Information about the evil shrine\n\n**Reputation increased!**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 50); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 2) }}\n\n[[Return to the ravine->cave_entrance]]",
      "tags": ["caves", "goblin", "good"],
      "position": {"x": -200, "y": 1250},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p033",
      "name": "slay_goblins",
      "text": "You show no mercy to the goblins. They were enemies, after all.\n\nYou find their treasure hoard and take it all.\n\n**You gained:**\n- 100 gold pieces\n- Various weapons and equipment\n\n**The goblin lair is completely cleared.**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 100) }}\n\n[[Return to the ravine->cave_entrance]]",
      "tags": ["caves", "goblin"],
      "position": {"x": 100, "y": 1250},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p034",
      "name": "evil_shrine",
      "text": "You approach the dark cave at the far end of the ravine. The air grows cold, and an evil presence weighs on your spirit.\n\nThe entrance is carved with blasphemous symbols. Inside, you can see flickering torchlight and hear chanting in a foul tongue.\n\nThis is the shrine of evil chaos - the source of the darkness in these caves.\n\n{{#if reputation >= 5}}Your victories have made you strong enough to face this challenge!{{else}}Are you truly ready for this?{{/if}}\n\n**Health:** {{health}}/{{max_health}}\n**Reputation:** {{reputation}}\n\n{{#if reputation >= 5}}[[Enter the shrine and face the evil within->face_evil]]{{/if}}\n{{#if reputation >= 5}}[[Search for a hidden chamber->cursed_idol_chamber]]{{/if}}\n{{#if reputation < 5}}[[You're not ready for this yet->shrine_retreat]]{{/if}}\n[[Retreat - this is too dangerous->cave_entrance]]",
      "tags": ["caves", "shrine", "final"],
      "position": {"x": 400, "y": 1100},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p035",
      "name": "shrine_retreat",
      "text": "You sense that you're not yet strong enough to face the evil in this shrine.\n\nPerhaps if you had defeated more enemies and gained more experience, you would be ready for this final challenge.\n\n**You need a reputation of at least 5 to face the shrine.**\n**Current reputation: {{reputation}}**\n\nConsider exploring the other caves first.\n\n[[Return to the ravine->cave_entrance]]",
      "tags": ["caves", "shrine"],
      "position": {"x": 600, "y": 1100},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p036",
      "name": "face_evil",
      "text": "You stride into the shrine with determination. The walls are covered in profane symbols, and a dark altar stands in the center of the chamber.\n\nAn evil priest in black robes turns to face you, surrounded by undead zombies!\n\n\"Foolish mortal!\" he shrieks. \"You dare enter the shrine of chaos?\"\n\nThe zombies lurch toward you, and the priest begins chanting a dark spell!\n\nThis is the final battle!\n\n**Health:** {{health}}/{{max_health}}\n\n[[Fight with everything you have!->final_battle]]\n[[Try to disrupt the priest's spell->disrupt_spell]]",
      "tags": ["caves", "shrine", "final", "boss"],
      "position": {"x": 400, "y": 1250},
      "size": {"width": 200, "height": 130}
    },
    {
      "pid": "p037",
      "name": "final_battle",
      "text": "You charge into battle against impossible odds!\n\nThe zombies claw at you, but your sword flashes, cutting them down one by one. Your victories in the caves have made you a true warrior!\n\n{{#if has_shield}}Your shield turns aside deathly blows!{{else}}You take several wounds from the undead!{{/if}}\n\nFinally, only the evil priest remains. He raises his staff to cast a final spell, but you're faster - your blade strikes true!\n\nThe priest falls with a scream, and the shrine begins to shake. Dark energy dissipates, and you feel the evil presence lift from the ravine.\n\n**VICTORY!**\n\n**You have cleansed the Caves of Chaos!**\n\n**Final damage:** {{#if has_shield}}15{{else}}20{{/if}} health\n**Health:** {{health - (has_shield and 15 or 20)}}/{{max_health}}\n\n{{lua: local damage = game_state:get_variable(\"has_shield\") and 15 or 20; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)) }}\n\n{{#if health <= 0}}[[You've been defeated at the last moment...->death]]{{else}}[[Claim your victory!->victory]]{{/if}}",
      "tags": ["caves", "shrine", "final", "boss"],
      "position": {"x": 300, "y": 1380},
      "size": {"width": 220, "height": 180}
    },
    {
      "pid": "p038",
      "name": "disrupt_spell",
      "text": "You throw your sword at the priest, disrupting his spell!\n\nThe dark energy backfires, destroying the priest and several of his zombie servants in a blast of dark fire!\n\nThe remaining zombies collapse as the evil magic controlling them dissipates.\n\nYou retrieve your sword and claim victory with minimal injury!\n\n**Clever strategy!**\n**Damage taken: 8 health**\n\n{{lua: local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - 8)) }}\n\n[[Claim your victory!->victory]]",
      "tags": ["caves", "shrine", "final", "boss"],
      "position": {"x": 550, "y": 1380},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p039",
      "name": "victory",
      "text": "**VICTORY!**\n\nYou have cleansed the Caves of Chaos and defeated the shrine of evil!\n\nSearching the shrine, you find considerable treasure:\n- 500 gold pieces\n- A magic sword +1\n- Various gems and jewelry\n- Ancient scrolls\n\n**Total gold: {{gold + 500}}**\n\nYou return to the Keep as a hero! The Castellan personally thanks you and grants you a noble title. The villagers celebrate your victory, and bards will sing of your deeds for years to come!\n\n**YOUR ADVENTURE IS COMPLETE!**\n\nFinal Statistics:\n- Health: {{health}}/{{max_health}}\n- Gold: {{gold + 500}}\n- Reputation: {{reputation + 10}}\n- Status: **HERO OF THE BORDERLANDS**\n\n*THE END*\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 500); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 10) }}",
      "tags": ["ending", "victory"],
      "position": {"x": 400, "y": 1550},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p040",
      "name": "death",
      "text": "**YOU HAVE FALLEN**\n\nYour adventure ends here in the darkness of the Caves of Chaos. Your body will join the countless bones that litter the ravine.\n\nPerhaps another hero will succeed where you failed...\n\nFinal Statistics:\n- Health: 0\n- Gold: {{gold}}\n- Reputation: {{reputation}}\n- Caves explored: {{(explored_kobold_lair and 1 or 0) + (explored_orc_lair and 1 or 0) + (explored_goblin_lair and 1 or 0)}}\n\n{{#if reputation >= 3}}You fought bravely and earned glory, even in defeat.{{else}}Perhaps better preparation would have served you well.{{/if}}\n\n**GAME OVER**\n\n*THE END*",
      "tags": ["ending", "death"],
      "position": {"x": 700, "y": 1550},
      "size": {"width": 200, "height": 180}
    },
    {
      "pid": "p041",
      "name": "castellan",
      "text": "You enter the inner keep and are led to the Castellan's audience chamber. The Castellan is a grizzled warrior with sharp eyes and an air of authority.\n\n{{#if not castellan_quest_active}}\n\"Adventurer,\" he says, studying you. \"I hear you're preparing to face the Caves of Chaos. A noble endeavor. I have a proposition: bring me proof that you've cleared the orc lair - their chief's head will suffice - and I'll reward you handsomely. 200 gold pieces and a magic sword.\"\n\n**Quest offered: Defeat the Orc Chief**\n\n{{lua: game_state:set_variable(\"castellan_quest_active\", true) }}\n{{else if castellan_quest_active and explored_orc_lair and not castellan_quest_complete}}\n\"You've returned! I heard of your victory at the orc lair. You're a true warrior. Here's your reward as promised.\"\n\n**You receive:**\n- 200 gold pieces\n- Magic Sword +1 (increases damage in combat)\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 200); game_state:set_variable(\"has_magic_sword\", true); game_state:set_variable(\"castellan_quest_complete\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 3) }}\n{{else if castellan_quest_complete}}\n\"Well done again, hero. The Keep is safer because of you.\"\n{{else}}\n\"The orcs still threaten us. Return when you've dealt with them.\"\n{{/if}}\n\n[[Leave the audience chamber->keep_entrance]]",
      "tags": ["keep", "quest"],
      "position": {"x": -250, "y": 150},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p042",
      "name": "training_yard",
      "text": "You enter the training yard where guards practice their combat skills. The master-at-arms, a burly veteran with scars crisscrossing his arms, notices you.\n\n\"Looking to sharpen your skills, adventurer? I can teach you some advanced techniques for a price.\"\n\n{{#if companion_name == \"none\"}}A grizzled warrior named Aldric practices nearby. He looks like he could be a valuable companion.{{/if}}\n\n**Training Options:**\n- Combat Training (50 gold) - Increases max health by 5\n- Defensive Techniques (40 gold) - Equivalent to a shield in combat\n\n**Your gold:** {{gold}}\n**Your health:** {{health}}/{{max_health}}\n\n{{#if gold >= 50}}[[Receive combat training (50 gold)->combat_training]]{{/if}}\n{{#if gold >= 40 and not has_shield}}[[Learn defensive techniques (40 gold)->defensive_training]]{{/if}}\n[[Practice with the training dummy->practice_dummy]]\n{{#if companion_name == \"none\"}}[[Talk to Aldric about joining you->recruit_aldric]]{{/if}}\n[[Leave the training yard->keep_entrance]]",
      "tags": ["keep", "training"],
      "position": {"x": -250, "y": 300},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p043",
      "name": "combat_training",
      "text": "The master-at-arms puts you through your paces. Hours of intense training leave you exhausted but stronger.\n\n\"You're a natural,\" he says with approval. \"You'll survive longer out there now.\"\n\n**Maximum health increased by 5!**\n**Current health restored!**\n**Gold:** {{gold - 50}}\n\n{{lua: game_state:set_variable(\"max_health\", game_state:get_variable(\"max_health\") + 5); game_state:set_variable(\"health\", game_state:get_variable(\"max_health\")); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 50) }}\n\n[[Continue training->training_yard]]\n[[Leave->keep_entrance]]",
      "tags": ["keep", "training"],
      "position": {"x": -400, "y": 400},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p044",
      "name": "defensive_training",
      "text": "The master-at-arms teaches you defensive stances and how to use your environment for protection.\n\n\"A good defense can be worth more than a sharp sword,\" he advises.\n\n**You've learned defensive techniques!**\n**This provides the same protection as a shield!**\n**Gold:** {{gold - 40}}\n\n{{lua: game_state:set_variable(\"has_shield\", true); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 40) }}\n\n[[Continue training->training_yard]]\n[[Leave->keep_entrance]]",
      "tags": ["keep", "training"],
      "position": {"x": -400, "y": 520},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p045",
      "name": "practice_dummy",
      "text": "You spend some time practicing your swordsmanship on the training dummy. It's good exercise and helps build confidence.\n\nThe guards nod approvingly as you work.\n\n**You feel more prepared for combat.**\n\n[[Continue->training_yard]]",
      "tags": ["keep", "training"],
      "position": {"x": -100, "y": 400},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p046",
      "name": "wilderness_exploration",
      "text": "As you travel through the wilderness toward the caves, you notice a narrow trail leading off into the forest.\n\nYou could follow it, or continue to the caves.\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n[[Follow the forest trail->forest_trail]]\n[[Continue to the caves->cave_entrance]]\n[[Return to the Keep->keep_entrance]]",
      "tags": ["wilderness"],
      "position": {"x": 300, "y": 450},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p047",
      "name": "forest_trail",
      "text": "You follow the overgrown trail deeper into the forest. The trees grow thick and twisted here, blocking out most of the sunlight.\n\nAfter a while, you smell smoke. Ahead, you see a small clearing with a crude hut.\n\n{{#if not met_hermit}}An old hermit sits outside, muttering to himself.{{else}}The hermit's hut stands in the clearing.{{/if}}\n\n**Health:** {{health}}/{{max_health}}\n\n{{#if not met_hermit}}[[Approach the hermit->meet_hermit]]{{/if}}\n{{#if met_hermit and not helped_hermit}}[[The hermit is here->hermit_return]]{{/if}}\n{{#if helped_hermit}}[[The hermit greets you warmly->hermit_friend]]{{/if}}\n[[Leave the clearing->wilderness_exploration]]",
      "tags": ["wilderness", "hermit"],
      "position": {"x": 500, "y": 450},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p048",
      "name": "meet_hermit",
      "text": "You approach cautiously. The hermit looks up with wild eyes.\n\n\"Visitors! Rare, rare indeed. Lost something, have you? Everyone loses something in these woods.\"\n\nHe seems harmless, if eccentric.\n\n\"I know these woods like the back of my hand. Even know secret ways into the caves. But I need something... yes, I need herbs. Magic herbs from the elven ruins to the north. Bring me those, and I'll share my knowledge.\"\n\n**Quest: Find magic herbs for the hermit**\n\n{{lua: game_state:set_variable(\"met_hermit\", true) }}\n\n[[Ask about the elven ruins->ask_ruins]]\n[[Promise to find the herbs->promise_herbs]]\n[[Leave->forest_trail]]",
      "tags": ["wilderness", "hermit", "quest"],
      "position": {"x": 700, "y": 450},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p049",
      "name": "ask_ruins",
      "text": "\"The elven ruins? Oh yes, very old, very dangerous. North of here, past the rocky outcrop. The elves are long gone, but their magic lingers. Beautiful blue flowers grow there - those are the herbs I need.\"\n\n\"But beware! The ruins are guarded by ancient magic. You'll need to be clever to survive.\"\n\n**You've learned the location of the elven ruins!**\n\n[[Promise to help->promise_herbs]]\n[[Leave->forest_trail]]",
      "tags": ["wilderness", "hermit"],
      "position": {"x": 850, "y": 550},
      "size": {"width": 170, "height": 100}
    },
    {
      "pid": "p050",
      "name": "promise_herbs",
      "text": "\"Good, good! Find those herbs, and I'll give you something valuable. A map! Shows secret passages in the caves. Makes things easier.\"\n\nThe hermit goes back to muttering and poking his fire.\n\n[[Leave to find the ruins->forest_trail]]",
      "tags": ["wilderness", "hermit"],
      "position": {"x": 700, "y": 600},
      "size": {"width": 170, "height": 80}
    },
    {
      "pid": "p051",
      "name": "hermit_return",
      "text": "The hermit looks up hopefully. \"Did you find my herbs? The blue flowers from the elven ruins?\"\n\n{{#if found_elven_ruins}}\n\"Ah! You have them! Wonderful, wonderful!\"\n\nHe takes the herbs carefully and hands you a worn piece of parchment.\n\n\"Here's my map. Secret passage into the bugbear caves. They guard great treasure but are very dangerous. This lets you avoid some of them.\"\n\n**You received the Hermit's Map!**\n**New area unlocked: Bugbear Lair**\n\n{{lua: game_state:set_variable(\"helped_hermit\", true); game_state:set_variable(\"has_hermit_map\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 2) }}\n\n[[Thank him->hermit_friend]]\n{{else}}\n\"Come back when you have them.\"\n\n[[Leave->forest_trail]]\n{{/if}}",
      "tags": ["wilderness", "hermit"],
      "position": {"x": 700, "y": 750},
      "size": {"width": 180, "height": 140}
    },
    {
      "pid": "p052",
      "name": "hermit_friend",
      "text": "The hermit nods at you warmly. \"You're a good soul. Not many help an old hermit these days.\"\n\n{{#if health < max_health}}\n\"You look hurt. Here, take this.\" He hands you a crude but effective healing poultice.\n\n**Health restored by 5!**\n\n{{lua: local health = game_state:get_variable(\"health\"); local max_health = game_state:get_variable(\"max_health\"); game_state:set_variable(\"health\", math.min(max_health, health + 5)) }}\n{{/if}}\n\n\"Stay safe out there.\"\n\n[[Rest here briefly->hermit_rest]]\n[[Leave->forest_trail]]",
      "tags": ["wilderness", "hermit"],
      "position": {"x": 850, "y": 750},
      "size": {"width": 170, "height": 100}
    },
    {
      "pid": "p053",
      "name": "hermit_rest",
      "text": "The hermit lets you rest by his fire for a while. He shares some simple food and tells you rambling stories about the old days.\n\nYou feel refreshed.\n\n**Health restored by 10!**\n\n{{lua: local health = game_state:get_variable(\"health\"); local max_health = game_state:get_variable(\"max_health\"); game_state:set_variable(\"health\", math.min(max_health, health + 10)) }}\n\n[[Leave feeling better->forest_trail]]",
      "tags": ["wilderness", "hermit", "rest"],
      "position": {"x": 1000, "y": 750},
      "size": {"width": 170, "height": 80}
    },
    {
      "pid": "p054",
      "name": "elven_ruins",
      "text": "You travel north and discover the ancient elven ruins. Crumbling stone pillars covered in vines stand in a perfect circle. In the center, blue flowers glow with a faint magical light.\n\n{{#if companion_name == \"none\" and found_elven_ruins}}An elven woman studies the ruins nearby. She looks wise and capable.{{/if}}\n\nAs you approach, the air shimmers and an ethereal figure materializes - an elven spirit!\n\n\"Who dares enter this sacred place?\" the spirit demands.\n\n**Health:** {{health}}/{{max_health}}\n\n[[Answer the spirit's riddle->riddle_guardian]]\n[[Explain you need the herbs to help someone->explain_herbs]]\n[[Try to grab the herbs and run->steal_herbs]]\n[[Attack the spirit->attack_spirit]]\n{{#if companion_name == \"none\" and found_elven_ruins}}[[Speak with the elf woman->recruit_lyra]]{{/if}}\n[[Leave respectfully->leave_ruins]]",
      "tags": ["wilderness", "ruins", "magic"],
      "position": {"x": 900, "y": 300},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p055",
      "name": "explain_herbs",
      "text": "You explain that you need the herbs to help an old hermit who lives in the forest.\n\nThe spirit's expression softens. \"The hermit... yes, I know of him. He was kind to my people long ago. Very well, take the herbs with my blessing.\"\n\nThe spirit hands you a bundle of the glowing blue flowers.\n\n\"Use them wisely. They have healing properties as well.\"\n\n**Magic herbs obtained!**\n**You can now return to the hermit!**\n\n{{lua: game_state:set_variable(\"found_elven_ruins\", true); game_state:set_variable(\"explored_hermit\", true) }}\n\n[[Thank the spirit and leave->forest_trail]]",
      "tags": ["wilderness", "ruins", "success"],
      "position": {"x": 900, "y": 450},
      "size": {"width": 180, "height": 110}
    },
    {
      "pid": "p056",
      "name": "steal_herbs",
      "text": "You attempt to grab the herbs and flee!\n\nThe spirit's eyes flash with anger. \"THIEF!\"\n\nMagical energy strikes you like lightning!\n\n**Damage taken: 15 health**\n\nYou're thrown back from the ruins without the herbs.\n\n{{lua: local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - 15)) }}\n\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}[[Retreat, wounded->forest_trail]]{{/if}}",
      "tags": ["wilderness", "ruins", "fail"],
      "position": {"x": 1100, "y": 400},
      "size": {"width": 170, "height": 100}
    },
    {
      "pid": "p057",
      "name": "attack_spirit",
      "text": "You foolishly attack the elven spirit!\n\nYour sword passes through the ethereal form harmlessly. The spirit shakes its head sadly.\n\n\"Violence is not the answer here, mortal. Leave now before I must defend this place.\"\n\nYou could try talking instead, or leave.\n\n[[Apologize and explain your mission->explain_herbs]]\n[[Leave->forest_trail]]",
      "tags": ["wilderness", "ruins"],
      "position": {"x": 1100, "y": 300},
      "size": {"width": 170, "height": 90}
    },
    {
      "pid": "p058",
      "name": "leave_ruins",
      "text": "You bow respectfully and begin to leave.\n\nThe spirit calls out: \"Wait. Your respect is noted. Why did you come here?\"\n\nPerhaps you should explain your purpose after all.\n\n[[Explain about the hermit->explain_herbs]]\n[[Leave without explaining->forest_trail]]",
      "tags": ["wilderness", "ruins"],
      "position": {"x": 700, "y": 300},
      "size": {"width": 170, "height": 80}
    },
    {
      "pid": "p059",
      "name": "bugbear_lair",
      "text": "{{#if has_hermit_map}}\nUsing the hermit's map, you find a hidden entrance to the bugbear caves. The secret passage allows you to bypass the guards!\n\nYou emerge in a large chamber filled with treasure - the bugbears' hoard! But the bugbear chieftain is here, a massive creature with muscles like tree trunks.\n\n\"How did you get in here?\" he roars in broken common tongue.\n{{else}}\nYou find the entrance to the bugbear caves. Two massive bugbears stand guard, each wielding a massive club.\n\nThis looks extremely dangerous without some advantage.\n{{/if}}\n\n**Health:** {{health}}/{{max_health}}\n\n{{#if has_hermit_map}}[[Fight the bugbear chieftain->fight_bugbear_chief]]{{/if}}\n{{#if has_hermit_map}}[[Try to bargain with the chieftain->bargain_bugbear]]{{/if}}\n{{#if not has_hermit_map}}[[This is too dangerous without a secret entrance->cave_entrance]]{{/if}}\n[[Retreat->cave_entrance]]",
      "tags": ["caves", "bugbear", "boss"],
      "position": {"x": -100, "y": 900},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p060",
      "name": "fight_bugbear_chief",
      "text": "You charge at the massive bugbear chieftain!\n\nThe battle is epic. The chieftain is incredibly strong, but you're faster and more skilled.\n\n{{#if has_magic_sword}}Your magic sword blazes with power, cutting through the bugbear's thick hide!{{else}}Your regular sword struggles against the creature's thick hide!{{/if}}\n\nAfter a brutal fight, the chieftain falls with a thunderous crash!\n\n**Victory!**\n**Damage taken:** {{#if has_magic_sword}}15{{else}}22{{/if}} health\n\n**Bugbear Treasure Found:**\n- 300 gold pieces\n- Gems worth 150 gold\n- A magical lantern that never goes out\n\n{{lua: local damage = game_state:get_variable(\"has_magic_sword\") and 15 or 22; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 450); game_state:set_variable(\"has_lantern\", true); game_state:set_variable(\"explored_bugbear_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 5) }}\n\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}[[Take the treasure and leave->cave_entrance]]{{/if}}",
      "tags": ["caves", "bugbear", "combat", "boss"],
      "position": {"x": -250, "y": 1050},
      "size": {"width": 200, "height": 180}
    },
    {
      "pid": "p061",
      "name": "bargain_bugbear",
      "text": "You hold up your hands peacefully. \"I don't want to fight. Perhaps we can make a deal?\"\n\nThe bugbear chieftain narrows his eyes. \"Deal? Humans always want deals. What you offer?\"\n\n{{#if gold >= 100}}\n[[Offer 100 gold for safe passage->pay_bugbear]]\n{{/if}}\n[[Offer to help them against their enemies->help_bugbear]]\n[[Never mind, prepare to fight->fight_bugbear_chief]]",
      "tags": ["caves", "bugbear", "diplomacy"],
      "position": {"x": 50, "y": 1050},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p062",
      "name": "pay_bugbear",
      "text": "You offer the chieftain 100 gold pieces. He examines the coins carefully, then grins showing massive teeth.\n\n\"Gold is good. You smart human. Take this as sign of respect.\"\n\nHe tosses you a small leather pouch containing gems!\n\n\"Now go. We have deal.\"\n\n**You paid 100 gold**\n**You received gems worth 80 gold**\n**You've made peace with the bugbears!**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 20); game_state:set_variable(\"explored_bugbear_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 3) }}\n\n[[Leave peacefully->cave_entrance]]",
      "tags": ["caves", "bugbear", "diplomacy"],
      "position": {"x": 200, "y": 1150},
      "size": {"width": 180, "height": 110}
    },
    {
      "pid": "p063",
      "name": "help_bugbear",
      "text": "\"Help us?\" The chieftain laughs. \"What can small human do?\"\n\n\"The orcs,\" you say. \"I can deal with the orcs. They've been taking your hunting grounds, haven't they?\"\n\nThe chieftain's expression changes. \"You know this? Yes, orcs are problem. You kill orc chief, we give you treasure. Good deal.\"\n\n{{#if explored_orc_lair}}\n\"Wait... you already kill orcs? You are mighty warrior! Take gift!\"\n\nHe gives you a share of the treasure hoard!\n\n**Received 200 gold pieces!**\n**Bugbears are now friendly!**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 200); game_state:set_variable(\"explored_bugbear_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 4) }}\n{{else}}\n\"Go kill orc chief first. Then we talk.\"\n{{/if}}\n\n[[Leave->cave_entrance]]",
      "tags": ["caves", "bugbear", "quest"],
      "position": {"x": -50, "y": 1150},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p064",
      "name": "random_encounter",
      "text": "As you travel through the wilderness, you encounter something unexpected!\n\n{{lua: local encounters = math.random(1, 4); game_state:set_variable(\"random_encounter_count\", game_state:get_variable(\"random_encounter_count\") + 1); game_state:set_variable(\"current_encounter\", encounters) }}\n\n{{#if current_encounter == 1}}[[You're ambushed by bandits!->encounter_bandits]]{{/if}}\n{{#if current_encounter == 2}}[[A pack of wolves blocks your path!->encounter_wolves]]{{/if}}\n{{#if current_encounter == 3}}[[You meet a traveling merchant!->encounter_merchant]]{{/if}}\n{{#if current_encounter == 4}}[[Keep guards are patrolling nearby!->encounter_guards]]{{/if}}",
      "tags": ["wilderness", "random"],
      "position": {"x": 500, "y": 600},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p065",
      "name": "encounter_bandits",
      "text": "Three rough-looking bandits step out from behind the trees, weapons drawn!\n\n\"Hand over your gold, and we might let you live!\" their leader sneers.\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n[[Fight the bandits!->fight_bandits]]\n{{#if gold >= 30}}[[Pay them 30 gold to avoid a fight->pay_bandits]]{{/if}}\n{{#if reputation >= 5}}[[Intimidate them with your reputation->intimidate_bandits]]{{/if}}\n[[Try to flee->flee_bandits]]",
      "tags": ["wilderness", "combat", "encounter"],
      "position": {"x": 350, "y": 700},
      "size": {"width": 180, "height": 110}
    },
    {
      "pid": "p066",
      "name": "fight_bandits",
      "text": "You draw your sword and attack!\n\nThe bandits are skilled but disorganized. Your training serves you well as you fight them off!\n\n{{#if has_shield}}Your shield deflects several attacks!{{else}}You take several cuts from their blades!{{/if}}\n\nAfter a fierce skirmish, the bandits flee into the woods!\n\n**Damage taken:** {{#if has_shield}}8{{else}}12{{/if}} health\n\nSearching the area, you find 40 gold they dropped!\n\n{{lua: local damage = game_state:get_variable(\"has_shield\") and 8 or 12; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 40) }}\n\n{{#if health <= 0}}[[You've been defeated...->death]]{{else}}[[Continue your journey->to_caves]]{{/if}}",
      "tags": ["wilderness", "combat", "encounter"],
      "position": {"x": 300, "y": 800},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p067",
      "name": "pay_bandits",
      "text": "You reluctantly hand over 30 gold pieces. The bandits count the coins and laugh.\n\n\"Smart choice, traveler. Now get lost!\"\n\nThey disappear into the forest with your gold.\n\n**Lost 30 gold**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 30) }}\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter"],
      "position": {"x": 500, "y": 800},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p068",
      "name": "intimidate_bandits",
      "text": "You step forward confidently. \"Do you know who I am? I've cleared the Caves of Chaos and defeated countless monsters. You're just three common thieves.\"\n\nThe bandits exchange nervous glances. Your reputation precedes you!\n\nThe leader swallows hard. \"Uh... maybe we made a mistake. No hard feelings?\"\n\nThey back away slowly, then turn and run!\n\n**Your reputation saved you!**\n**No damage taken, no gold lost!**\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter"],
      "position": {"x": 200, "y": 800},
      "size": {"width": 170, "height": 100}
    },
    {
      "pid": "p069",
      "name": "flee_bandits",
      "text": "You turn and run! The bandits give chase, and one manages to slash at your back before you escape!\n\n**Damage taken: 10 health**\n**You escaped but were wounded!**\n\n{{lua: local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - 10)) }}\n\n{{#if health <= 0}}[[You've collapsed from your wounds...->death]]{{else}}[[Continue, wounded->to_caves]]{{/if}}",
      "tags": ["wilderness", "encounter"],
      "position": {"x": 400, "y": 900},
      "size": {"width": 170, "height": 90}
    },
    {
      "pid": "p070",
      "name": "encounter_wolves",
      "text": "A pack of hungry wolves surrounds you, growling menacingly! Their eyes glow in the dim forest light.\n\nThere are five of them - too many to fight easily!\n\n**Health:** {{health}}/{{max_health}}\n\n[[Stand your ground and fight!->fight_wolves]]\n{{#if has_torch}}[[Use your torch to scare them away->scare_wolves]]{{/if}}\n[[Climb a tree to escape->climb_tree]]",
      "tags": ["wilderness", "combat", "encounter"],
      "position": {"x": 650, "y": 700},
      "size": {"width": 170, "height": 100}
    },
    {
      "pid": "p071",
      "name": "fight_wolves",
      "text": "You fight back against the wolf pack! They attack from multiple directions, snapping and clawing!\n\n{{#if has_magic_sword}}Your magic sword blazes, driving them back!{{else}}Your regular sword struggles to keep them all at bay!{{/if}}\n\nAfter a desperate battle, you manage to wound several wolves and the pack retreats, dragging their injured with them.\n\n**Damage taken:** {{#if has_magic_sword}}10{{else}}16{{/if}} health\n**You survived the wolf attack!**\n\n{{lua: local damage = game_state:get_variable(\"has_magic_sword\") and 10 or 16; local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - damage)) }}\n\n{{#if health <= 0}}[[You've been overwhelmed...->death]]{{else}}[[Continue your journey->to_caves]]{{/if}}",
      "tags": ["wilderness", "combat", "encounter"],
      "position": {"x": 600, "y": 800},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p072",
      "name": "scare_wolves",
      "text": "You grab your torch and wave it at the wolves, yelling loudly!\n\nWolves fear fire! The pack backs away, whimpering, and then flees into the forest!\n\n**Smart thinking! No damage taken!**\n**Your torch saved you!**\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter"],
      "position": {"x": 800, "y": 800},
      "size": {"width": 170, "height": 80}
    },
    {
      "pid": "p073",
      "name": "climb_tree",
      "text": "{{#if has_rope}}You use your rope to quickly climb a tall tree! The wolves circle below but can't reach you.\n\nAfter waiting for an hour, the wolves lose interest and leave. You climb down safely.\n\n**Your rope saved you! No damage taken!**\n{{else}}You attempt to climb a tree, but without rope it's difficult! A wolf bites your leg as you scramble up!\n\nYou manage to reach safety, but you're wounded. After an hour, the wolves leave.\n\n**Damage taken: 8 health**\n\n{{lua: local health = game_state:get_variable(\"health\"); game_state:set_variable(\"health\", math.max(0, health - 8)) }}\n{{/if}}\n\n{{#if health <= 0}}[[Your wounds are too severe...->death]]{{else}}[[Continue your journey->to_caves]]{{/if}}",
      "tags": ["wilderness", "encounter"],
      "position": {"x": 700, "y": 900},
      "size": {"width": 180, "height": 110}
    },
    {
      "pid": "p074",
      "name": "encounter_merchant",
      "text": "You encounter a traveling merchant with a small cart pulled by a donkey. He seems friendly and waves you over.\n\n\"Greetings, traveler! Looking for supplies? I have some special items today!\"\n\n**Special merchant items:**\n- Superior Healing Potion - Restores 15 health (45 gold)\n- Map of the Caves - Shows secret paths (60 gold)\n- Lucky Charm - Increases your luck (30 gold)\n\n**Your gold:** {{gold}}\n\n{{#if gold >= 45}}[[Buy Superior Healing Potion (45 gold)->buy_super_potion]]{{/if}}\n{{#if gold >= 60 and not has_map}}[[Buy Map of the Caves (60 gold)->buy_cave_map]]{{/if}}\n{{#if gold >= 30}}[[Buy Lucky Charm (30 gold)->buy_lucky_charm]]{{/if}}\n[[Politely decline and continue->to_caves]]",
      "tags": ["wilderness", "encounter", "shop"],
      "position": {"x": 900, "y": 700},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p075",
      "name": "buy_super_potion",
      "text": "You purchase the superior healing potion. The merchant hands you a large vial filled with glowing red liquid.\n\n\"This will heal you much better than a common potion!\" he says with a smile.\n\n**Superior Healing Potion acquired!**\n**Restores 15 health when used**\n**Gold:** {{gold - 45}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 45); game_state:set_variable(\"has_healing_potion\", true) }}\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter", "shop"],
      "position": {"x": 850, "y": 850},
      "size": {"width": 170, "height": 90}
    },
    {
      "pid": "p076",
      "name": "buy_cave_map",
      "text": "You purchase the map of the caves. It shows detailed passages and marks several secret rooms!\n\n\"This map has saved many adventurers!\" the merchant assures you.\n\n**Map of the Caves acquired!**\n**You can now find the secret chamber!**\n**Gold:** {{gold - 60}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 60); game_state:set_variable(\"has_map\", true); game_state:set_variable(\"found_secret_chamber\", true) }}\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter", "shop"],
      "position": {"x": 1050, "y": 850},
      "size": {"width": 170, "height": 100}
    },
    {
      "pid": "p077",
      "name": "buy_lucky_charm",
      "text": "You purchase the lucky charm - a small amulet with a four-leaf clover inside.\n\n\"This will bring you good fortune!\" the merchant promises.\n\nYou're not sure if it's magic or just superstition, but it feels good to have it.\n\n**Lucky Charm acquired!**\n**Reputation +1**\n**Gold:** {{gold - 30}}\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 30); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 1) }}\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter", "shop"],
      "position": {"x": 950, "y": 950},
      "size": {"width": 170, "height": 90}
    },
    {
      "pid": "p078",
      "name": "encounter_guards",
      "text": "You encounter a patrol of guards from the Keep making their rounds through the wilderness.\n\nTheir captain recognizes you. {{#if reputation >= 5}}\"Ah! The hero who's been clearing the caves! Well met!\"{{else}}\"Halt! State your business in these parts.\"{{/if}}\n\n{{#if reputation >= 5}}\nThe guards are impressed by your reputation and share some rations with you.\n\n**Health restored by 5!**\n**The guards give you 20 gold as a reward!**\n\n{{lua: local health = game_state:get_variable(\"health\"); local max_health = game_state:get_variable(\"max_health\"); game_state:set_variable(\"health\", math.min(max_health, health + 5)); game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 20) }}\n{{else}}\nYou explain you're an adventurer. They nod and let you pass.\n\n\"Be careful out here,\" the captain warns.\n{{/if}}\n\n[[Continue your journey->to_caves]]",
      "tags": ["wilderness", "encounter"],
      "position": {"x": 1100, "y": 700},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p079",
      "name": "riddle_guardian",
      "text": "As you approach the glowing herbs in the elven ruins, the spirit raises its hand.\n\n\"Wait, mortal. Before I can grant you the herbs, you must prove your wisdom. Answer this riddle:\"\n\nThe spirit's voice echoes through the ruins:\n\n*\"I speak without a mouth and hear without ears.*\n*I have no body, but come alive with fears.*\n*What am I?\"*\n\n**Think carefully...**\n\n[[Answer: \"An Echo\"->riddle_correct]]\n[[Answer: \"A Ghost\"->riddle_wrong]]\n[[Answer: \"The Wind\"->riddle_wrong]]\n[[Give up and leave->leave_ruins]]",
      "tags": ["wilderness", "ruins", "puzzle"],
      "position": {"x": 1100, "y": 450},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p080",
      "name": "riddle_correct",
      "text": "\"An echo,\" you answer confidently.\n\nThe spirit smiles warmly. \"Correct! You have wisdom as well as courage. Few mortals solve this riddle.\"\n\nThe spirit hands you not only the glowing herbs, but also a small vial of shimmering liquid.\n\n\"Take this elven draught as well. It will restore you fully when needed.\"\n\n**Magic herbs obtained!**\n**Elven Draught obtained! (Fully restores health once)**\n**Riddle solved! Reputation +2**\n\n{{lua: game_state:set_variable(\"found_elven_ruins\", true); game_state:set_variable(\"explored_hermit\", true); game_state:set_variable(\"solved_riddle\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 2) }}\n\n[[Thank the spirit and leave->forest_trail]]",
      "tags": ["wilderness", "ruins", "puzzle", "success"],
      "position": {"x": 1100, "y": 600},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p081",
      "name": "riddle_wrong",
      "text": "\"Incorrect,\" the spirit says, shaking its head. \"But I admire your attempt. You may still have the herbs if you tell me why you need them.\"\n\n[[Explain about the hermit->explain_herbs]]",
      "tags": ["wilderness", "ruins", "puzzle"],
      "position": {"x": 1300, "y": 550},
      "size": {"width": 170, "height": 70}
    },
    {
      "pid": "p082",
      "name": "secret_chamber",
      "text": "{{#if has_map or found_secret_chamber}}Using your map, you discover a hidden passage in the caves! A secret door opens to reveal an ancient chamber.\n\nInside, four stone statues stand in a circle around a pedestal. Each statue holds a different symbol:\n- A statue facing North holds a Sun\n- A statue facing East holds a Moon\n- A statue facing South holds a Star\n- A statue facing West holds a Cloud\n\nOn the pedestal is an inscription:\n\n*\"When day gives way to night,*\n*And stars emerge from light,*\n*Turn us in the order true,*\n*To claim the treasure waiting for you.\"*\n\nThe statues can be rotated. What order should they face the pedestal?\n\n[[Rotate: Sun, Moon, Star, Cloud->statue_correct]]\n[[Rotate: Moon, Star, Cloud, Sun->statue_wrong]]\n[[Rotate: Sun, Star, Moon, Cloud->statue_wrong]]\n[[Leave without solving the puzzle->cave_entrance]]\n{{else}}You sense there might be secret passages in these caves, but you need a map to find them.\n\n[[Continue exploring->cave_entrance]]{{/if}}",
      "tags": ["caves", "puzzle", "secret"],
      "position": {"x": 600, "y": 1100},
      "size": {"width": 200, "height": 160}
    },
    {
      "pid": "p083",
      "name": "statue_correct",
      "text": "You rotate the statues in order: Sun, Moon, Star, Cloud.\n\nThe pedestal begins to glow! The statues slide aside, revealing a hidden compartment beneath!\n\nInside you find:\n- 250 gold pieces\n- A ring of protection (reduces damage by 3 in all fights)\n- Ancient scrolls of knowledge\n\n**Puzzle solved!**\n**You've found the secret treasure!**\n**Reputation +3**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 250); game_state:set_variable(\"has_shield\", true); game_state:set_variable(\"solved_statue_puzzle\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 3) }}\n\n[[Take the treasure and leave->cave_entrance]]",
      "tags": ["caves", "puzzle", "treasure", "success"],
      "position": {"x": 600, "y": 1280},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p084",
      "name": "statue_wrong",
      "text": "You rotate the statues... but nothing happens. That wasn't the right order.\n\nThe puzzle remains unsolved. Perhaps you should think about the riddle more carefully?\n\n*\"When day gives way to night, and stars emerge from light...\"*\n\nDay to night suggests the order: Sun  Moon  Star. And clouds come last?\n\n[[Try again->secret_chamber]]\n[[Give up and leave->cave_entrance]]",
      "tags": ["caves", "puzzle"],
      "position": {"x": 800, "y": 1280},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p085",
      "name": "diplomatic_victory",
      "text": "**THE DIPLOMAT'S TRIUMPH**\n\nYou have achieved something remarkable - you've made peace with all the tribes in the Caves of Chaos!\n\nThe kobolds, goblins, orcs, and bugbears have agreed to a truce. You've brokered deals between them and shown that cooperation benefits everyone.\n\nThe evil shrine has been abandoned, its priests fleeing when they realized the tribes would no longer serve them.\n\nYou return to the Keep not as a warrior, but as a peacemaker. The Castellan is amazed.\n\n\"You've done what I thought impossible. These creatures may yet become trading partners rather than enemies.\"\n\n**PEACEFUL ENDING ACHIEVED**\n\nFinal Statistics:\n- Health: {{health}}/{{max_health}}\n- Gold: {{gold}}\n- Reputation: {{reputation}}\n- Status: **PEACEMAKER OF THE BORDERLANDS**\n- Battles avoided through diplomacy: 5+\n\n*THE END*",
      "tags": ["ending", "diplomacy", "victory"],
      "position": {"x": 100, "y": 1550},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p086",
      "name": "treasure_hunter_ending",
      "text": "**THE FORTUNE SEEKER**\n\nYou've amassed a considerable fortune from your adventures in the Caves of Chaos! Gold, gems, magic items - your pack is heavy with treasure.\n\nRather than seeking glory or completing quests, you've focused on wealth. And you've succeeded beyond your wildest dreams.\n\nWith {{gold}} gold pieces and valuable treasures, you decide to retire from adventuring. You purchase a manor near the Keep and live comfortably.\n\nThe Castellan sometimes asks for your help, but you're content to enjoy your riches. Occasionally you tell stories of your adventures to young would-be heroes.\n\n**WEALTHY ENDING ACHIEVED**\n\nFinal Statistics:\n- Health: {{health}}/{{max_health}}\n- Gold: {{gold}}\n- Reputation: {{reputation}}\n- Status: **WEALTHY MERCHANT**\n- Treasure hoards found: 8+\n\n*THE END*",
      "tags": ["ending", "treasure"],
      "position": {"x": -100, "y": 1550},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p087",
      "name": "cursed_ending",
      "text": "**THE CURSED ONE**\n\nIn your explorations, you discovered a dark idol in the evil shrine. Despite warnings, you touched it, drawn by promises of power.\n\nDark energy flooded into you. You gained strength... but at a terrible cost.\n\nYou've been cursed by the forces of chaos. Your victories feel hollow. The gold you've earned turns to dust. Your reputation means nothing.\n\nYou wander the Borderlands as a cursed soul, neither fully alive nor dead. The Keep's gates close when you approach. Even the monsters in the caves fear you now.\n\nYou've become what you fought against - a creature of darkness, doomed to walk these lands forever.\n\n**CURSED ENDING**\n\nFinal Statistics:\n- Health: {{health}}/{{max_health}} (Cursed)\n- Gold: 0 (Turns to dust)\n- Reputation: {{reputation}} (Meaningless)\n- Status: **CURSED WANDERER**\n- Warning: Some treasures are not worth their price\n\n*THE END*",
      "tags": ["ending", "cursed", "bad"],
      "position": {"x": 600, "y": 1550},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p088",
      "name": "hermit_ending",
      "text": "**THE HERMIT'S PATH**\n\nAfter all your adventures, you've grown weary of violence and civilization. The old hermit's simple life appeals to you.\n\nYou decide to stay in the forest, taking over the hermit's hut when he passes away peacefully. You learn his ways - healing herbs, forest lore, and meditation.\n\nOccasionally, adventurers find your clearing. You offer them advice and healing, just as the hermit did for you. You've found peace in solitude.\n\nThe Keep forgets your name, but forest creatures know you as a friend. You've traded fame for tranquility.\n\nYears later, a young adventurer knocks on your door asking for help. You smile, remembering your own journey, and invite them in.\n\n**HERMIT ENDING ACHIEVED**\n\nFinal Statistics:\n- Health: {{health}}/{{max_health}}\n- Gold: {{gold}} (No longer important)\n- Reputation: {{reputation}} (Faded)\n- Status: **FOREST HERMIT**\n- Wisdom gained: Immeasurable\n\n*THE END*",
      "tags": ["ending", "peaceful", "hermit"],
      "position": {"x": 900, "y": 1550},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p089",
      "name": "corrupted_ending",
      "text": "**THE DARK CHAMPION**\n\nPower corrupted you. The more enemies you defeated, the more you craved battle and bloodshed.\n\nInstead of destroying the evil shrine, you claimed it for yourself. The dark powers there whispered promises of strength, and you listened.\n\nYou've become the new master of the Caves of Chaos. The monsters that once opposed you now serve you. Your magic sword blazes with unholy fire.\n\nThe Keep sends heroes to stop you, but none succeed. You've become the very evil you once fought.\n\nYour name becomes legend - a cautionary tale of a hero who fell to darkness.\n\n**DARK ENDING ACHIEVED**\n\nFinal Statistics:\n- Health: {{health}}/{{max_health}} (Enhanced by dark magic)\n- Gold: {{gold}}\n- Reputation: {{reputation}} (Now feared, not respected)\n- Status: **DARK LORD OF CHAOS**\n- Corruption: Complete\n\n*THE END*",
      "tags": ["ending", "evil", "dark"],
      "position": {"x": 1200, "y": 1550},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p090",
      "name": "check_endings",
      "text": "Your adventure has reached a crossroads. Multiple paths lie before you:\n\n{{#if reputation >= 10 and not explored_bugbear_lair and not explored_orc_lair}}[[Try to make peace with all tribes->work_toward_peace]]{{/if}}\n{{#if gold >= 500}}[[Retire with your fortune->treasure_hunter_ending]]{{/if}}\n{{#if helped_hermit}}[[Embrace the hermit's way of life->hermit_ending]]{{/if}}\n{{#if reputation >= 8}}[[Approach the evil shrine with intentions of power->corrupted_path]]{{/if}}\n[[Continue your adventures normally->cave_entrance]]",
      "tags": ["choice", "endings"],
      "position": {"x": 400, "y": 1400},
      "size": {"width": 200, "height": 130}
    },
    {
      "pid": "p091",
      "name": "work_toward_peace",
      "text": "You decide to attempt the nearly impossible - making peace with all the tribes in the Caves of Chaos.\n\nThis will require careful diplomacy, strategic thinking, and possibly some coin to smooth negotiations.\n\n{{#if explored_kobold_lair and explored_goblin_lair and not explored_orc_lair and not explored_bugbear_lair}}\nYou've already dealt with the kobolds and goblins peacefully. Now you need to approach the orcs and bugbears.\n\n**Continue with peaceful negotiations**\n\n{{lua: game_state:set_variable(\"made_peace_all_tribes\", true) }}\n\n[[Approach the orcs peacefully->peace_with_orcs]]\n{{else}}\nYou need to deal with the tribes more diplomatically. Return when you've found peaceful solutions.\n\n[[Reconsider->cave_entrance]]\n{{/if}}",
      "tags": ["quest", "diplomacy"],
      "position": {"x": 200, "y": 1400},
      "size": {"width": 180, "height": 130}
    },
    {
      "pid": "p092",
      "name": "peace_with_orcs",
      "text": "You approach the orc lair with a white flag. The guards are suspicious but intrigued.\n\n\"You want talk? Not fight?\" one asks.\n\nYou explain your vision - peace between all tribes, trade with the Keep, an end to constant warfare.\n\nThe orc chief considers this. \"We tired of fighting too. But we need food, supplies. Keep gives us this, we make peace.\"\n\n{{#if gold >= 100}}\n[[Pay 100 gold as a peace offering->orc_peace_success]]\n{{/if}}\n[[Promise to negotiate with the Castellan->negotiate_castellan]]\n[[This won't work - fight them->fight_orc_guards]]",
      "tags": ["quest", "diplomacy", "orc"],
      "position": {"x": 50, "y": 1530},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p093",
      "name": "orc_peace_success",
      "text": "You pay 100 gold as a gesture of good faith. The orc chief is impressed.\n\n\"You keep word. We keep word too. Peace.\"\n\nThe orcs agree to a truce. Two tribes down, one to go!\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") - 100); game_state:set_variable(\"explored_orc_lair\", true); game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 5) }}\n\n[[Now approach the bugbears->bargain_bugbear]]",
      "tags": ["quest", "diplomacy", "success"],
      "position": {"x": -100, "y": 1650},
      "size": {"width": 170, "height": 90}
    },
    {
      "pid": "p094",
      "name": "negotiate_castellan",
      "text": "You return to the Keep and present your peace plan to the Castellan. He's skeptical but willing to try.\n\n\"If you can truly bring peace to the Borderlands, I'll support it. But you must prove the tribes are sincere.\"\n\nHe gives you trade goods worth 200 gold to facilitate negotiations.\n\n**Received trade goods!**\n\n{{lua: game_state:set_variable(\"gold\", game_state:get_variable(\"gold\") + 200) }}\n\n[[Return to negotiate with the tribes->peace_with_orcs]]",
      "tags": ["quest", "diplomacy"],
      "position": {"x": 100, "y": 1650},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p095",
      "name": "corrupted_path",
      "text": "The dark shrine calls to you. Instead of destroying it, you wonder... what if you claimed its power?\n\nYou enter the shrine alone. The evil priest offers you a choice:\n\n\"Join us, and you'll have power beyond imagining. Resist, and face destruction.\"\n\nDeep down, you feel the corruption tempting you. The battles have changed you.\n\n[[Accept the dark power->corrupted_ending]]\n[[Resist and fight!->final_battle]]\n[[Leave before it's too late->cave_entrance]]",
      "tags": ["choice", "dark", "corruption"],
      "position": {"x": 600, "y": 1400},
      "size": {"width": 180, "height": 110}
    },
    {
      "pid": "p096",
      "name": "cursed_idol_chamber",
      "text": "Deep in the evil shrine, you discover a hidden chamber. In the center sits a black idol, pulsing with malevolent energy.\n\nA voice whispers in your mind: *\"Touch me, and gain ultimate power...\"*\n\nEvery instinct screams this is dangerous, but the promise of power is tempting.\n\n**Health:** {{health}}/{{max_health}} | **Gold:** {{gold}}\n\n[[Touch the idol->touch_cursed_idol]]\n[[Destroy the idol->destroy_idol]]\n[[Leave it alone->evil_shrine]]",
      "tags": ["caves", "shrine", "cursed", "choice"],
      "position": {"x": 550, "y": 1250},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p097",
      "name": "touch_cursed_idol",
      "text": "Against your better judgment, you reach out and touch the dark idol.\n\nAgony! Dark energy floods through you! You scream as corruption seeps into your soul!\n\n**YOU HAVE BEEN CURSED!**\n\nThe idol crumbles to dust, but the damage is done. You feel different... wrong.\n\n{{lua: game_state:set_variable(\"touched_cursed_idol\", true); game_state:set_variable(\"health\", 1) }}\n\n[[Flee the chamber->cursed_ending]]",
      "tags": ["caves", "cursed", "bad"],
      "position": {"x": 700, "y": 1350},
      "size": {"width": 180, "height": 90}
    },
    {
      "pid": "p098",
      "name": "destroy_idol",
      "text": "You raise your sword and strike the idol with all your might!\n\nThe idol shatters! Dark energy explodes outward, but you stand firm. The evil dissipates!\n\n**You've destroyed a source of great evil!**\n**Reputation +5**\n**You feel cleansed and stronger!**\n**Max health +5**\n\n{{lua: game_state:set_variable(\"reputation\", game_state:get_variable(\"reputation\") + 5); game_state:set_variable(\"max_health\", game_state:get_variable(\"max_health\") + 5); game_state:set_variable(\"health\", game_state:get_variable(\"max_health\")) }}\n\n[[Leave the chamber victorious->evil_shrine]]",
      "tags": ["caves", "shrine", "victory"],
      "position": {"x": 400, "y": 1350},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p099",
      "name": "character_creation_intro",
      "text": "**The Keep on the Borderlands**\n*A Solo RPG Adventure*\n\n{{#if character_created}}\nYou are {{player_name}}, a Level {{level}} {{class}} seeking adventure and glory in the dangerous Borderlands.\n\n[[Begin your adventure->start]]\n[[View character sheet->character_sheet]]\n{{else}}\nWelcome, adventurer! Before you begin your journey, you must create your character.\n\nThe Borderlands are dangerous, and your choice of class will greatly affect your adventure. Each class has unique abilities and approaches to challenges.\n\n[[Create your character->class_selection]]\n{{/if}}",
      "tags": ["character", "creation"],
      "position": {"x": 100, "y": -200},
      "size": {"width": 200, "height": 120}
    },
    {
      "pid": "p100",
      "name": "class_selection",
      "text": "**Choose Your Class**\n\nSelect your adventuring class. Each class has different strengths and abilities:\n\n**Fighter** - Masters of combat\n- High Strength and Constitution\n- Special: Power Strike, Second Wind\n- Best at: Direct combat, tanking damage\n\n**Rogue** - Cunning and agile\n- High Dexterity and Charisma\n- Special: Sneak Attack, Lockpicking expertise\n- Best at: Stealth, traps, persuasion\n\n**Cleric** - Holy warriors and healers\n- High Wisdom and Constitution\n- Special: Healing, Turn Undead\n- Best at: Healing, undead encounters\n\n**Mage** - Wielders of arcane power\n- High Intelligence and Wisdom\n- Special: Spell slots, Arcane knowledge\n- Best at: Magic, puzzles, ranged attacks\n\n[[Choose Fighter->create_fighter]]\n[[Choose Rogue->create_rogue]]\n[[Choose Cleric->create_cleric]]\n[[Choose Mage->create_mage]]",
      "tags": ["character", "creation"],
      "position": {"x": 100, "y": -80},
      "size": {"width": 220, "height": 180}
    },
    {
      "pid": "p101",
      "name": "create_fighter",
      "text": "**Fighter - Weapon Master**\n\nYou have chosen the path of the warrior. Your training with weapons and armor is unmatched.\n\n**Starting Stats:**\n- Strength: 16 (+3)\n- Dexterity: 12 (+1)\n- Constitution: 15 (+2)\n- Intelligence: 8 (-1)\n- Wisdom: 10 (+0)\n- Charisma: 10 (+0)\n\n**Starting Equipment:**\n- Longsword (1d8+3 damage)\n- Chainmail Armor (AC 15)\n- Shield\n- Adventuring gear\n\n**Special Abilities:**\n- Power Strike (3 stamina): Deal double damage\n- Second Wind (5 stamina): Heal 1d10+2 HP\n\n**Max HP: 28** | **Stamina: 12**\n\n{{lua: game_state:set_variable(\"class\", \"Fighter\"); game_state:set_variable(\"strength\", 16); game_state:set_variable(\"dexterity\", 12); game_state:set_variable(\"constitution\", 15); game_state:set_variable(\"intelligence\", 8); game_state:set_variable(\"wisdom\", 10); game_state:set_variable(\"charisma\", 10); game_state:set_variable(\"max_health\", 28); game_state:set_variable(\"health\", 28); game_state:set_variable(\"max_stamina\", 12); game_state:set_variable(\"stamina\", 12); game_state:set_variable(\"weapon_name\", \"Longsword\"); game_state:set_variable(\"weapon_damage\", \"1d8\"); game_state:set_variable(\"weapon_bonus\", 3); game_state:set_variable(\"armor_name\", \"Chainmail\"); game_state:set_variable(\"armor_ac\", 15); game_state:set_variable(\"has_shield\", true); game_state:set_variable(\"armor_class\", 17); game_state:set_variable(\"attack_bonus\", 5); game_state:set_variable(\"damage_bonus\", 3) }}\n\n[[Confirm character->finalize_character]]\n[[Choose different class->class_selection]]",
      "tags": ["character", "creation", "fighter"],
      "position": {"x": -100, "y": 80},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p102",
      "name": "create_rogue",
      "text": "**Rogue - Shadow Dancer**\n\nYou have chosen the path of cunning and stealth. Your quick fingers and silver tongue will serve you well.\n\n**Starting Stats:**\n- Strength: 10 (+0)\n- Dexterity: 16 (+3)\n- Constitution: 12 (+1)\n- Intelligence: 12 (+1)\n- Wisdom: 10 (+0)\n- Charisma: 15 (+2)\n\n**Starting Equipment:**\n- Rapier (1d8+3 damage)\n- Leather Armor (AC 14)\n- Thieves' Tools\n- Lockpicks\n\n**Special Abilities:**\n- Sneak Attack (2 stamina): Triple damage on surprised enemies\n- Quick Dodge (1 stamina): Avoid one attack\n\n**Skills:** +3 Lockpicking, +2 Persuasion, +2 Stealth\n\n**Max HP: 22** | **Stamina: 14**\n\n{{lua: game_state:set_variable(\"class\", \"Rogue\"); game_state:set_variable(\"strength\", 10); game_state:set_variable(\"dexterity\", 16); game_state:set_variable(\"constitution\", 12); game_state:set_variable(\"intelligence\", 12); game_state:set_variable(\"wisdom\", 10); game_state:set_variable(\"charisma\", 15); game_state:set_variable(\"max_health\", 22); game_state:set_variable(\"health\", 22); game_state:set_variable(\"max_stamina\", 14); game_state:set_variable(\"stamina\", 14); game_state:set_variable(\"weapon_name\", \"Rapier\"); game_state:set_variable(\"weapon_damage\", \"1d8\"); game_state:set_variable(\"weapon_bonus\", 3); game_state:set_variable(\"armor_name\", \"Leather Armor\"); game_state:set_variable(\"armor_ac\", 14); game_state:set_variable(\"armor_class\", 17); game_state:set_variable(\"attack_bonus\", 5); game_state:set_variable(\"damage_bonus\", 3); game_state:set_variable(\"skill_lockpicking\", 3); game_state:set_variable(\"skill_persuasion\", 2); game_state:set_variable(\"skill_stealth\", 2) }}\n\n[[Confirm character->finalize_character]]\n[[Choose different class->class_selection]]",
      "tags": ["character", "creation", "rogue"],
      "position": {"x": 100, "y": 80},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p103",
      "name": "create_cleric",
      "text": "**Cleric - Divine Champion**\n\nYou have chosen to serve the gods. Your faith grants you healing power and protection against evil.\n\n**Starting Stats:**\n- Strength: 12 (+1)\n- Dexterity: 10 (+0)\n- Constitution: 14 (+2)\n- Intelligence: 10 (+0)\n- Wisdom: 16 (+3)\n- Charisma: 13 (+1)\n\n**Starting Equipment:**\n- Mace (1d6+1 damage)\n- Scale Mail (AC 14)\n- Shield\n- Holy Symbol\n\n**Special Abilities:**\n- Healing Word (3 stamina): Heal ally 2d4+3 HP\n- Turn Undead (4 stamina): Frighten undead enemies\n- Divine Protection (2 stamina): +2 AC for one combat\n\n**Skills:** +3 Medicine, +2 Perception\n\n**Max HP: 26** | **Stamina: 13**\n\n{{lua: game_state:set_variable(\"class\", \"Cleric\"); game_state:set_variable(\"strength\", 12); game_state:set_variable(\"dexterity\", 10); game_state:set_variable(\"constitution\", 14); game_state:set_variable(\"intelligence\", 10); game_state:set_variable(\"wisdom\", 16); game_state:set_variable(\"charisma\", 13); game_state:set_variable(\"max_health\", 26); game_state:set_variable(\"health\", 26); game_state:set_variable(\"max_stamina\", 13); game_state:set_variable(\"stamina\", 13); game_state:set_variable(\"weapon_name\", \"Mace\"); game_state:set_variable(\"weapon_damage\", \"1d6\"); game_state:set_variable(\"weapon_bonus\", 1); game_state:set_variable(\"armor_name\", \"Scale Mail\"); game_state:set_variable(\"armor_ac\", 14); game_state:set_variable(\"has_shield\", true); game_state:set_variable(\"armor_class\", 16); game_state:set_variable(\"attack_bonus\", 3); game_state:set_variable(\"damage_bonus\", 1); game_state:set_variable(\"skill_medicine\", 3); game_state:set_variable(\"skill_perception\", 2) }}\n\n[[Confirm character->finalize_character]]\n[[Choose different class->class_selection]]",
      "tags": ["character", "creation", "cleric"],
      "position": {"x": 300, "y": 80},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p104",
      "name": "create_mage",
      "text": "**Mage - Arcane Scholar**\n\nYou have chosen the path of magic. Your spells will devastate enemies and solve impossible puzzles.\n\n**Starting Stats:**\n- Strength: 8 (-1)\n- Dexterity: 12 (+1)\n- Constitution: 10 (+0)\n- Intelligence: 16 (+3)\n- Wisdom: 14 (+2)\n- Charisma: 11 (+0)\n\n**Starting Equipment:**\n- Quarterstaff (1d6-1 damage)\n- Robes (AC 11)\n- Spellbook\n- Component pouch\n\n**Special Abilities:**\n- Magic Missile (3 stamina): Auto-hit for 3d4+3 damage\n- Shield Spell (2 stamina): +4 AC for one combat\n- Fireball (5 stamina): 6d6 damage to all enemies\n\n**Skills:** +3 Arcana, +2 Perception\n\n**Max HP: 18** | **Stamina: 16**\n\n{{lua: game_state:set_variable(\"class\", \"Mage\"); game_state:set_variable(\"strength\", 8); game_state:set_variable(\"dexterity\", 12); game_state:set_variable(\"constitution\", 10); game_state:set_variable(\"intelligence\", 16); game_state:set_variable(\"wisdom\", 14); game_state:set_variable(\"charisma\", 11); game_state:set_variable(\"max_health\", 18); game_state:set_variable(\"health\", 18); game_state:set_variable(\"max_stamina\", 16); game_state:set_variable(\"stamina\", 16); game_state:set_variable(\"weapon_name\", \"Quarterstaff\"); game_state:set_variable(\"weapon_damage\", \"1d6\"); game_state:set_variable(\"weapon_bonus\", -1); game_state:set_variable(\"armor_name\", \"Robes\"); game_state:set_variable(\"armor_ac\", 11); game_state:set_variable(\"armor_class\", 12); game_state:set_variable(\"attack_bonus\", 2); game_state:set_variable(\"damage_bonus\", -1); game_state:set_variable(\"skill_arcana\", 3); game_state:set_variable(\"skill_perception\", 2) }}\n\n[[Confirm character->finalize_character]]\n[[Choose different class->class_selection]]",
      "tags": ["character", "creation", "mage"],
      "position": {"x": 500, "y": 80},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p105",
      "name": "finalize_character",
      "text": "**Character Creation Complete!**\n\nYour character is ready for adventure!\n\n**Level {{level}} {{class}}**\n\n**Stats:**\n- STR: {{strength}} | DEX: {{dexterity}} | CON: {{constitution}}\n- INT: {{intelligence}} | WIS: {{wisdom}} | CHA: {{charisma}}\n\n**Combat:**\n- HP: {{health}}/{{max_health}}\n- Stamina: {{stamina}}/{{max_stamina}}\n- AC: {{armor_class}}\n- Attack: +{{attack_bonus}}\n\n**Equipment:**\n- Weapon: {{weapon_name}} ({{weapon_damage}}{{#if weapon_bonus > 0}}+{{weapon_bonus}}{{/if}})\n- Armor: {{armor_name}} (AC {{armor_ac}})\n\n{{lua: game_state:set_variable(\"character_created\", true) }}\n\nYou are ready to begin your adventure in the Borderlands!\n\n[[Begin your adventure->start]]\n[[View full character sheet->character_sheet]]",
      "tags": ["character", "creation"],
      "position": {"x": 250, "y": 300},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p106",
      "name": "character_sheet",
      "text": "**Character Sheet**\n\n**{{player_name}} - Level {{level}} {{class}}**\nExperience: {{experience}}/{{lua: return (game_state:get_variable(\"level\") * 100) }} XP\n\n**Attributes:**\n- Strength: {{strength}} | Dexterity: {{dexterity}} | Constitution: {{constitution}}\n- Intelligence: {{intelligence}} | Wisdom: {{wisdom}} | Charisma: {{charisma}}\n\n**Combat Stats:**\n- HP: {{health}}/{{max_health}}\n- Stamina: {{stamina}}/{{max_stamina}}\n- Armor Class: {{armor_class}}\n- Attack Bonus: +{{attack_bonus}}\n- Damage Bonus: +{{damage_bonus}}\n\n**Skills:**\n{{#if skill_persuasion > 0}}- Persuasion: +{{skill_persuasion}}{{/if}}\n{{#if skill_perception > 0}}- Perception: +{{skill_perception}}{{/if}}\n{{#if skill_lockpicking > 0}}- Lockpicking: +{{skill_lockpicking}}{{/if}}\n{{#if skill_stealth > 0}}- Stealth: +{{skill_stealth}}{{/if}}\n{{#if skill_arcana > 0}}- Arcana: +{{skill_arcana}}{{/if}}\n{{#if skill_medicine > 0}}- Medicine: +{{skill_medicine}}{{/if}}\n\n**Equipment:**\n- Weapon: {{weapon_name}} ({{weapon_damage}}{{#if weapon_bonus != 0}}{{weapon_bonus}}{{/if}})\n- Armor: {{armor_name}} (AC {{armor_ac}})\n- Gold: {{gold}} gp\n\n**Companion:** {{#if companion_name != \"none\"}}{{companion_name}} (HP: {{companion_health}}/{{companion_max_health}}, Loyalty: {{companion_loyalty}}){{else}}None{{/if}}\n\n**Alignment:** {{#if alignment_good_evil > 5}}Good{{else if alignment_good_evil < -5}}Evil{{else}}Neutral{{/if}} / {{#if alignment_lawful_chaotic > 5}}Lawful{{else if alignment_lawful_chaotic < -5}}Chaotic{{else}}Neutral{{/if}}\n\n{{lua: if game_state:get_variable(\"experience\") >= game_state:get_variable(\"level\") * 100 then game_state:set_variable(\"can_level_up\", true) else game_state:set_variable(\"can_level_up\", false) end }}\n\n{{#if can_level_up}}**[[Level Up Available!->level_up]]**{{/if}}\n\n[[View Quest Journal->quest_journal]]\n[[Return->keep_entrance]]",
      "tags": ["character", "sheet"],
      "position": {"x": 450, "y": 300},
      "size": {"width": 220, "height": 200}
    },
    {
      "pid": "p107",
      "name": "level_up",
      "text": "**LEVEL UP!**\n\nCongratulations! You've gained enough experience to advance to level {{level + 1}}!\n\n**Benefits:**\n- Max HP +{{lua: return (game_state:get_variable(\"class\") == \"Fighter\" and 10) or (game_state:get_variable(\"class\") == \"Rogue\" and 7) or (game_state:get_variable(\"class\") == \"Cleric\" and 8) or 6 }}\n- Max Stamina +2\n- +1 to two attributes of your choice\n- +1 Skill Point\n\n{{lua: local class = game_state:get_variable(\"class\"); local hp_gain = (class == \"Fighter\" and 10) or (class == \"Rogue\" and 7) or (class == \"Cleric\" and 8) or 6; game_state:set_variable(\"level\", game_state:get_variable(\"level\") + 1); game_state:set_variable(\"max_health\", game_state:get_variable(\"max_health\") + hp_gain); game_state:set_variable(\"health\", game_state:get_variable(\"max_health\")); game_state:set_variable(\"max_stamina\", game_state:get_variable(\"max_stamina\") + 2); game_state:set_variable(\"stamina\", game_state:get_variable(\"max_stamina\")); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") + 1); game_state:set_variable(\"experience\", 0) }}\n\n**You are now Level {{level}}!**\n\nChoose two attributes to increase by +1:\n\n[[Increase Strength and Constitution->level_up_str_con]]\n[[Increase Dexterity and Wisdom->level_up_dex_wis]]\n[[Increase Intelligence and Charisma->level_up_int_cha]]\n[[Increase Strength and Dexterity->level_up_str_dex]]\n[[Increase Constitution and Wisdom->level_up_con_wis]]",
      "tags": ["character", "level"],
      "position": {"x": 650, "y": 300},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p108",
      "name": "level_up_str_con",
      "text": "**Attributes Increased!**\n\nStrength: {{strength}}  {{strength + 1}}\nConstitution: {{constitution}}  {{constitution + 1}}\n\n{{lua: game_state:set_variable(\"strength\", game_state:get_variable(\"strength\") + 1); game_state:set_variable(\"constitution\", game_state:get_variable(\"constitution\") + 1); local str_mod = math.floor((game_state:get_variable(\"strength\") - 10) / 2); game_state:set_variable(\"damage_bonus\", str_mod); game_state:set_variable(\"attack_bonus\", game_state:get_variable(\"level\") + str_mod + 2) }}\n\nYou have **{{skill_points}} skill point(s)** to spend.\n\n[[Spend skill points->skill_improvement]]\n[[Save for later->character_sheet]]",
      "tags": ["character", "level"],
      "position": {"x": 550, "y": 450},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p109",
      "name": "level_up_dex_wis",
      "text": "**Attributes Increased!**\n\nDexterity: {{dexterity}}  {{dexterity + 1}}\nWisdom: {{wisdom}}  {{wisdom + 1}}\n\n{{lua: game_state:set_variable(\"dexterity\", game_state:get_variable(\"dexterity\") + 1); game_state:set_variable(\"wisdom\", game_state:get_variable(\"wisdom\") + 1); local dex_mod = math.floor((game_state:get_variable(\"dexterity\") - 10) / 2); if game_state:get_variable(\"class\") == \"Rogue\" then game_state:set_variable(\"attack_bonus\", game_state:get_variable(\"level\") + dex_mod + 2); game_state:set_variable(\"damage_bonus\", dex_mod) end }}\n\nYou have **{{skill_points}} skill point(s)** to spend.\n\n[[Spend skill points->skill_improvement]]\n[[Save for later->character_sheet]]",
      "tags": ["character", "level"],
      "position": {"x": 750, "y": 450},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p110",
      "name": "level_up_int_cha",
      "text": "**Attributes Increased!**\n\nIntelligence: {{intelligence}}  {{intelligence + 1}}\nCharisma: {{charisma}}  {{charisma + 1}}\n\n{{lua: game_state:set_variable(\"intelligence\", game_state:get_variable(\"intelligence\") + 1); game_state:set_variable(\"charisma\", game_state:get_variable(\"charisma\") + 1) }}\n\nYou have **{{skill_points}} skill point(s)** to spend.\n\n[[Spend skill points->skill_improvement]]\n[[Save for later->character_sheet]]",
      "tags": ["character", "level"],
      "position": {"x": 950, "y": 450},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p111",
      "name": "level_up_str_dex",
      "text": "**Attributes Increased!**\n\nStrength: {{strength}}  {{strength + 1}}\nDexterity: {{dexterity}}  {{dexterity + 1}}\n\n{{lua: game_state:set_variable(\"strength\", game_state:get_variable(\"strength\") + 1); game_state:set_variable(\"dexterity\", game_state:get_variable(\"dexterity\") + 1); local str_mod = math.floor((game_state:get_variable(\"strength\") - 10) / 2); local dex_mod = math.floor((game_state:get_variable(\"dexterity\") - 10) / 2); if game_state:get_variable(\"class\") == \"Fighter\" then game_state:set_variable(\"damage_bonus\", str_mod); game_state:set_variable(\"attack_bonus\", game_state:get_variable(\"level\") + str_mod + 2) elseif game_state:get_variable(\"class\") == \"Rogue\" then game_state:set_variable(\"attack_bonus\", game_state:get_variable(\"level\") + dex_mod + 2); game_state:set_variable(\"damage_bonus\", dex_mod) end }}\n\nYou have **{{skill_points}} skill point(s)** to spend.\n\n[[Spend skill points->skill_improvement]]\n[[Save for later->character_sheet]]",
      "tags": ["character", "level"],
      "position": {"x": 650, "y": 570},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p112",
      "name": "level_up_con_wis",
      "text": "**Attributes Increased!**\n\nConstitution: {{constitution}}  {{constitution + 1}}\nWisdom: {{wisdom}}  {{wisdom + 1}}\n\n{{lua: game_state:set_variable(\"constitution\", game_state:get_variable(\"constitution\") + 1); game_state:set_variable(\"wisdom\", game_state:get_variable(\"wisdom\") + 1) }}\n\nYou have **{{skill_points}} skill point(s)** to spend.\n\n[[Spend skill points->skill_improvement]]\n[[Save for later->character_sheet]]",
      "tags": ["character", "level"],
      "position": {"x": 850, "y": 570},
      "size": {"width": 180, "height": 100}
    },
    {
      "pid": "p113",
      "name": "skill_improvement",
      "text": "**Skill Improvement**\n\nYou have **{{skill_points}} skill point(s)** to spend.\n\nSpend a point to increase a skill:\n\n**Current Skills:**\n- Persuasion: {{skill_persuasion}}\n- Perception: {{skill_perception}}\n- Lockpicking: {{skill_lockpicking}}\n- Stealth: {{skill_stealth}}\n- Arcana: {{skill_arcana}}\n- Medicine: {{skill_medicine}}\n\n{{#if skill_points > 0}}\n[[Improve Persuasion (+1)->improve_persuasion]]\n[[Improve Perception (+1)->improve_perception]]\n[[Improve Lockpicking (+1)->improve_lockpicking]]\n[[Improve Stealth (+1)->improve_stealth]]\n[[Improve Arcana (+1)->improve_arcana]]\n[[Improve Medicine (+1)->improve_medicine]]\n{{else}}\nNo skill points available.\n{{/if}}\n\n[[Finish->character_sheet]]",
      "tags": ["character", "skills"],
      "position": {"x": 750, "y": 700},
      "size": {"width": 200, "height": 130}
    },
    {
      "pid": "p114",
      "name": "improve_persuasion",
      "text": "**Persuasion improved!**\n\nPersuasion: {{skill_persuasion}}  {{skill_persuasion + 1}}\n\n{{lua: game_state:set_variable(\"skill_persuasion\", game_state:get_variable(\"skill_persuasion\") + 1); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") - 1) }}\n\n[[Continue->skill_improvement]]",
      "tags": ["character", "skills"],
      "position": {"x": 600, "y": 850},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p115",
      "name": "improve_perception",
      "text": "**Perception improved!**\n\nPerception: {{skill_perception}}  {{skill_perception + 1}}\n\n{{lua: game_state:set_variable(\"skill_perception\", game_state:get_variable(\"skill_perception\") + 1); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") - 1) }}\n\n[[Continue->skill_improvement]]",
      "tags": ["character", "skills"],
      "position": {"x": 750, "y": 850},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p116",
      "name": "improve_lockpicking",
      "text": "**Lockpicking improved!**\n\nLockpicking: {{skill_lockpicking}}  {{skill_lockpicking + 1}}\n\n{{lua: game_state:set_variable(\"skill_lockpicking\", game_state:get_variable(\"skill_lockpicking\") + 1); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") - 1) }}\n\n[[Continue->skill_improvement]]",
      "tags": ["character", "skills"],
      "position": {"x": 900, "y": 850},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p117",
      "name": "improve_stealth",
      "text": "**Stealth improved!**\n\nStealth: {{skill_stealth}}  {{skill_stealth + 1}}\n\n{{lua: game_state:set_variable(\"skill_stealth\", game_state:get_variable(\"skill_stealth\") + 1); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") - 1) }}\n\n[[Continue->skill_improvement]]",
      "tags": ["character", "skills"],
      "position": {"x": 600, "y": 950},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p118",
      "name": "improve_arcana",
      "text": "**Arcana improved!**\n\nArcana: {{skill_arcana}}  {{skill_arcana + 1}}\n\n{{lua: game_state:set_variable(\"skill_arcana\", game_state:get_variable(\"skill_arcana\") + 1); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") - 1) }}\n\n[[Continue->skill_improvement]]",
      "tags": ["character", "skills"],
      "position": {"x": 750, "y": 950},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p119",
      "name": "improve_medicine",
      "text": "**Medicine improved!**\n\nMedicine: {{skill_medicine}}  {{skill_medicine + 1}}\n\n{{lua: game_state:set_variable(\"skill_medicine\", game_state:get_variable(\"skill_medicine\") + 1); game_state:set_variable(\"skill_points\", game_state:get_variable(\"skill_points\") - 1) }}\n\n[[Continue->skill_improvement]]",
      "tags": ["character", "skills"],
      "position": {"x": 900, "y": 950},
      "size": {"width": 160, "height": 80}
    },
    {
      "pid": "p120",
      "name": "quest_journal",
      "text": "**Quest Journal**\n\n**Main Quests:**\n{{#if quest_clear_caves < 5}} Clear the Caves of Chaos ({{quest_clear_caves}}/5 lairs){{else}} Clear the Caves of Chaos (Complete!){{/if}}\n\n**Side Quests:**\n{{#if quest_merchant_treasure}} Merchant's Hidden Treasure (Complete!){{else}} Merchant's Hidden Treasure{{/if}}\n{{#if quest_hermit_herbs}} Help the Hermit (Complete!){{else}} Help the Hermit{{/if}}\n{{#if quest_castellan_orcs}} Castellan's Bounty (Complete!){{else if castellan_quest_active}} Castellan's Bounty (Active){{else}} Castellan's Bounty (Not started){{/if}}\n\n**Progress:**\n- Monsters Killed: {{monsters_killed}}\n- Caves Explored: {{quest_clear_caves}}/5\n- Reputation: {{reputation}}\n\n**Alignment:**\n- Morality: {{#if alignment_good_evil > 5}}Good{{else if alignment_good_evil < -5}}Evil{{else}}Neutral{{/if}}\n- Order: {{#if alignment_lawful_chaotic > 5}}Lawful{{else if alignment_lawful_chaotic < -5}}Chaotic{{else}}Neutral{{/if}}\n\n[[Return to character sheet->character_sheet]]\n[[Close->keep_entrance]]",
      "tags": ["quest", "journal"],
      "position": {"x": 650, "y": 500},
      "size": {"width": 200, "height": 150}
    },
    {
      "pid": "p121",
      "name": "recruit_aldric",
      "text": "**Recruit Aldric the Warrior**\n\nAt the training yard, you notice a grizzled warrior practicing with a longsword. His movements are precise and deadly.\n\nThe master-at-arms introduces him: \"This is Aldric, a veteran of many battles. He's looking for worthy companions to join him on adventures.\"\n\nAldric sizes you up. \"You look capable. I could use someone to watch my back in those caves. What do you say?\"\n\n{{#if companion_name == \"none\"}}\n**Aldric's Stats:**\n- HP: 30/30\n- Ability: **Protective** - Takes 50% of damage meant for you\n- Personality: Brave and loyal\n\n[[Recruit Aldric as your companion->aldric_join]]\n[[Decline politely->training_yard]]\n{{else}}\n\"I see you already have a companion. Come back if you part ways.\"\n\n[[Leave->training_yard]]\n{{/if}}",
      "tags": ["companion", "recruitment"],
      "position": {"x": -400, "y": 500},
      "size": {"width": 200, "height": 130}
    },
    {
      "pid": "p122",
      "name": "aldric_join",
      "text": "**Aldric Joins Your Party!**\n\nAldric nods approvingly. \"You've got spirit. I like that. Let's go show those monsters what we're made of!\"\n\nHe grabs his gear and joins you.\n\n**Companion Acquired: Aldric the Warrior**\n- HP: 30/30\n- Loyalty: 50\n- Ability: Protective (takes 50% of damage in combat)\n\n{{lua: game_state:set_variable(\"companion_name\", \"Aldric\"); game_state:set_variable(\"companion_health\", 30); game_state:set_variable(\"companion_max_health\", 30); game_state:set_variable(\"companion_loyalty\", 50); game_state:set_variable(\"companion_ability\", \"protective\") }}\n\nWith Aldric at your side, you feel more confident facing the dangers ahead!\n\n[[Return to Keep->keep_entrance]]\n[[View character sheet->character_sheet]]",
      "tags": ["companion", "recruitment"],
      "position": {"x": -550, "y": 630},
      "size": {"width": 180, "height": 120}
    },
    {
      "pid": "p123",
      "name": "recruit_lyra",
      "text": "**Recruit Lyra the Elf**\n\nAs you explore the elven ruins, you notice an elf woman examining the ancient pillars with a scholar's interest.\n\nShe turns as you approach. \"Fascinating, aren't they? These ruins hold secrets of my ancestors.\" She looks at you with keen elven eyes. \"You seek the herbs? I've been studying them too. Perhaps we could work together?\"\n\n{{#if companion_name == \"none\" and found_elven_ruins}}\n**Lyra's Stats:**\n- HP: 24/24\n- Ability: **Sharp Eye** - +20% to find hidden items and secrets\n- Personality: Wise and cautious\n\n[[Recruit Lyra as your companion->lyra_join]]\n[[Decline politely->elven_ruins]]\n{{else if companion_name != \"none\"}}\n\"I see you travel with a companion already. May your path be blessed.\"\n\n[[Leave->elven_ruins]]\n{{else}}\n\"Perhaps after you complete your business here, we can talk.\"\n\n[[Leave->elven_ruins]]\n{{/if}}",
      "tags": ["companion", "recruitment"],
      "position": {"x": 1100, "y": 150},
      "size": {"width": 200, "height": 130}
    },
    {
      "pid": "p124",
      "name": "lyra_join",
      "text": "**Lyra Joins Your Party!**\n\nLyra smiles warmly. \"Together we'll uncover the mysteries of these lands. My skills will aid you in your quest.\"\n\nShe gathers her belongings and joins you.\n\n**Companion Acquired: Lyra the Elf**\n- HP: 24/24\n- Loyalty: 50\n- Ability: Sharp Eye (improved treasure finding)\n\n{{lua: game_state:set_variable(\"companion_name\", \"Lyra\"); game_state:set_variable(\"companion_health\", 24); game_state:set_variable(\"companion_max_health\", 24); game_state:set_variable(\"companion_loyalty\", 50); game_state:set_variable(\"companion_ability\", \"sharp_eye\") }}\n\nWith Lyra's wisdom at your side, you feel ready to face any challenge!\n\n[[Return to the trail->forest_trail]]\n[[View character sheet->character_sheet]]",
      "tags": ["companion", "recruitment"],
      "position": {"x": 1250, "y": 280},
      "size": {"width": 180, "height": 120}
    }
  ],
  "scripts": [],
  "stylesheets": [],
  "assets": []
}
